import{d as m,l as he,f as ne,p as te,e as Ro,r as x,j as h,a as t,u as Bt,F as Lt,i as Le,L as Yo,b as X,c as Q,P as _t,g as re,h as O,B as U,S as $,k as E,A as it,m as dt,I as ct,n as ut,R as Rt,o as f,M as se,q as J,D as _e,s as W,C as le,t as Ho,T as Se,v as Yt,w as $o,x as Fo,y as Uo,z as Wo,E as Go,G as zo,H as Qo,J as Ht,K as mt,N as Jo,O as Re,Q as Ne,U as Vo,V as Ko,W as Zo,X as $t,Y as Xo,Z as ea,_ as ae,$ as Oe,a0 as Ft,a1 as Ut,a2 as Wt,a3 as Ye,a4 as ta,a5 as ie,a6 as oa,a7 as aa,a8 as na,a9 as ra,aa as sa,ab as la,ac as ia,ad as da,ae as Me,af as ca,ag as Ie,ah as ua,ai as ma,aj as pt,ak as ht,al as Gt,am as pa,an as ha,ao as ga,ap as fa,aq as ya,ar as wa,as as ba,at as ka,au as va,av as xa,aw as Ca,ax as be,ay as He,az as Da,aA as Ta,aB as Aa,aC as Sa,aD as Na,aE as Oa,aF as Ma,aG as Ia,aH as Ea,aI as qa,aJ as Pa}from"./vendor.4aeb5d97.js";const ja=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function a(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerpolicy&&(s.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?s.credentials="include":r.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=a(r);fetch(r.href,s)}};ja();const Ee="yyyy-MM-dd",Ba="yyyy-MM-dd EEE",La="Daily Log",qe=/^((?:[0-9]|0[0-9]|1[0-9]|2[0-3]):[0-5][0-9])(-(?:[0-9]|0[0-9]|1[0-9]|2[0-3]):[0-5][0-9])*/,$e=/>\[[\d -:]+\]\(#(agenda:\/\/[^\n\r ]+)\)/,Fe=/>\[\[#(agenda:\/\/[^\n\r ]+)\]\[[\d -:]+\]\]/,Ue=/>\[[🍅 0-9min]+\]\(#(agenda-pomo:\/\/[^\n\r ]+)\)/,We=/>\[\[#(agenda-pomo:\/\/[^\n\r ]+)\]\[[🍅 0-9min]+\]\]/,zt=[{value:"day",label:"Daily"},{value:"week",label:"Weekly"},{value:"2week",label:"2 Weeks"},{value:"month",label:"Monthly"}],_a=[{value:"light",label:"Light"},{value:"dark",label:"Dark"},{value:"auto",label:"Auto"}],Ra=[{value:"green",label:"Green"},{value:"purple",label:"Purple"}],K={theme:"auto",lightThemeType:"green",homePage:"dashboard",defaultView:"month",weekStartDay:0,weekHourStart:0,weekHourEnd:24,defaultDuration:{value:.5,unit:"h"},logKey:{id:La,bgColor:"#047857",textColor:"#fff",borderColor:"#047857",enabled:!0},journal:{id:"Journal",bgColor:"#047857",textColor:"#fff",borderColor:"#047857",enabled:!0,query:[{script:`
[:find (pull ?block [*])
:where
[?block :block/marker ?marker]
[(missing? $ ?block :block/deadline)]
(not [(missing? $ ?block :block/scheduled)])
[(contains? #{"TODO" "DOING" "NOW" "LATER" "WAITING" "DONE"} ?marker)]]
        `,scheduleStart:"scheduled",dateFormatter:"yyyyMMdd",queryType:"advanced",isMilestone:!1},{script:`
[:find (pull ?block [*])
:where
[?block :block/marker ?marker]
[(missing? $ ?block :block/scheduled)]
(not [(missing? $ ?block :block/deadline)])
[(contains? #{"TODO" "DOING" "NOW" "LATER" "WAITING" "DONE"} ?marker)]]
        `,scheduleStart:"deadline",dateFormatter:"yyyyMMdd",queryType:"advanced",isMilestone:!1},{script:`
[:find (pull
?block
[:block/uuid
  :db/id
  :block/parent
  :block/left
  :block/collapsed?
  :block/format
  :block/_refs
  :block/path-refs
  :block/tags
  :block/content
  :block/marker
  :block/priority
  :block/properties
  :block/pre-block?
  :block/scheduled
  :block/deadline
  :block/repeated?
  :block/created-at
  :block/updated-at
  :block/file
  :block/heading-level
  {:block/page
  [:db/id :block/name :block/original-name :block/journal-day :block/journal?]}])
:where
[?block :block/page ?page]
[?page :block/journal? true]
[?block :block/marker ?marker]
[(contains? #{"TODO" "DOING" "NOW" "LATER" "WAITING" "DONE"} ?marker)]
[(missing? $ ?block :block/scheduled)]
[(missing? $ ?block :block/deadline)]]
        `,scheduleStart:"page.journal-day",dateFormatter:"yyyyMMdd",isMilestone:!1,queryType:"advanced"},{script:`
[:find (pull
  ?block
  [:block/uuid
    :block/parent
    :db/id
    :block/left
    :block/collapsed?
    :block/format
    :block/_refs
    :block/path-refs
    :block/tags
    :block/content
    :block/marker
    :block/priority
    :block/properties
    :block/pre-block?
    :block/scheduled
    :block/deadline
    :block/repeated?
    :block/created-at
    :block/updated-at
    :block/file
    :block/heading-level
    {:block/page
      [:db/id :block/name :block/original-name :block/journal-day :block/journal?]}
    {:block/refs
      [:block/journal-day]}])
  :where
  [?block :block/marker ?marker]
  [?rp :block/journal? true]
  [?block :block/refs ?rp]
  [(contains? #{"TODO" "DOING" "NOW" "LATER" "WAITING" "DONE"} ?marker)]]
        `,scheduleStart:"refs[0].journal-day",dateFormatter:"yyyyMMdd",isMilestone:!1,queryType:"advanced"},{script:`
[:find (pull ?block [*])
:where
[?rp :block/name "milestone"]
[?block :block/scheduled]
[?block :block/refs ?rp]]
        `,scheduleStart:"scheduled",dateFormatter:"yyyyMMdd",isMilestone:!0,queryType:"advanced"}]},projectList:[],calendarList:[],subscriptionList:[],pomodoro:{pomodoro:25,shortBreak:5,longBreak:15,autoStartBreaks:!1,autoStartPomodoros:!1,longBreakInterval:4,commonPomodoros:[10,15,20,25,40]}},Ya={light:{"month.holidayExceptThisMonth.color":"#f3acac","month.dayExceptThisMonth.color":"#bbb","month.weekend.backgroundColor":"#fafafa","month.day.fontSize":"16px","week.daygrid.borderRight":"1px solid #ddd","week.daygrid.backgroundColor":"inherit","week.daygridLeft.width":"77px","week.daygridLeft.backgroundColor":"#a8def74d","week.daygridLeft.paddingRight":"5px","week.daygridLeft.borderRight":"1px solid #ddd","week.today.backgroundColor":"#b857d81f","week.weekend.backgroundColor":"#fafafa","week.timegridLeft.width":"77px","week.timegridLeft.backgroundColor":"#03a9f44d","week.timegridLeft.borderRight":"1px solid #ddd","week.timegridLeft.fontSize":"12px","week.timegridLeftTimezoneLabel.height":"51px","week.timegridLeftAdditionalTimezone.backgroundColor":"#fdfdfd","week.timegridOneHour.height":"48px","week.timegridHalfHour.height":"24px","week.timegridHalfHour.borderBottom":"1px dotted #f9f9f9","week.timegridHorizontalLine.borderBottom":"1px solid #eee","week.timegrid.paddingRight":"10px","week.timegrid.borderRight":"1px solid #ddd","week.timegridSchedule.borderRadius":"0","week.timegridSchedule.paddingLeft":"0","week.currentTime.color":"#135de6","week.currentTime.fontSize":"12px","week.currentTime.fontWeight":"bold","week.pastTime.color":"#808080","week.pastTime.fontWeight":"normal","week.futureTime.color":"#333","week.futureTime.fontWeight":"normal","week.currentTimeLinePast.border":"1px solid rgba(19, 93, 230, 0.3)","week.currentTimeLineBullet.backgroundColor":"#135de6","week.currentTimeLineToday.border":"1px solid #135de6","week.currentTimeLineFuture.border":"1px solid #135de6"},dark:{"common.backgroundColor":"#32373d","common.saturday.color":"#babec4","common.dayname.color":"#babec4","common.border":"1px solid #58595c","common.creationGuide.backgroundColor":"#32373d","month.dayname.borderLeft":"1px solid #58595c","month.holidayExceptThisMonth.color":"#f3acac","month.dayExceptThisMonth.color":"#bbb","month.weekend.backgroundColor":"#282c31","month.day.fontSize":"16px","week.vpanelSplitter.border":"1px solid #58595c","week.today.color":"#fff","week.pastDay.color":"#8f9296","week.dayname.borderTop":"1px solid #58595c","week.dayname.borderBottom":"1px solid #58595c","week.daygrid.borderRight":"1px solid #58595c","week.daygrid.backgroundColor":"inherit","week.daygridLeft.width":"77px","week.daygridLeft.backgroundColor":"rgba(252, 183, 20, 0.3)","week.daygridLeft.paddingRight":"5px","week.daygridLeft.borderRight":"1px solid #58595c","week.today.backgroundColor":"#b857d81f","week.weekend.backgroundColor":"#282c31","week.timegridLeft.width":"77px","week.timegridLeft.backgroundColor":"rgba(252, 183, 20, 0.4)","week.timegridLeft.borderRight":"1px solid #58595c","week.timegridLeft.fontSize":"12px","week.timegridLeftTimezoneLabel.height":"51px","week.timegridLeftAdditionalTimezone.backgroundColor":"#fdfdfd","week.timegridOneHour.height":"48px","week.timegridHalfHour.height":"24px","week.timegridHalfHour.borderBottom":"1px dotted #3d3e40","week.timegridHorizontalLine.borderBottom":"1px solid #58595c","week.timegrid.paddingRight":"10px","week.timegrid.borderRight":"1px solid #58595c","week.timegridSchedule.borderRadius":"0","week.timegridSchedule.paddingLeft":"0","week.currentTime.color":"#fcb714","week.currentTime.fontSize":"12px","week.currentTime.fontWeight":"bold","week.pastTime.color":"#bababd","week.pastTime.fontWeight":"normal","week.futureTime.color":"#dadade","week.futureTime.fontWeight":"normal","week.currentTimeLinePast.border":"1px solid rgba(252, 183, 20, 0.4)","week.currentTimeLineBullet.backgroundColor":"#fcb714","week.currentTimeLineToday.border":"1px solid #fcb714","week.currentTimeLineFuture.border":"1px solid #fcb714"}},Qt="yyyyMMdd",Ha=[{value:"m",label:"minute"},{value:"h",label:"hour"}],Jt="Agenda",Vt="|`~|",Kt={id:void 0,bgColor:"#b8e986",textColor:"#4a4a4a",borderColor:"#047857",enabled:!0},ke=(e,o="blue")=>console.log(`%c${e}`,`color:${o}`),Ge=e=>{const o=document.querySelector("html"),a=logseq.settings?.lightThemeType||K.lightThemeType,n=a==="green"?"purple":"green";e==="dark"?(o?.classList.add("dark"),o?.classList.remove(a),Xt("./antd.dark.min.css")):(o?.classList.remove("dark",n),o?.classList.add(a),Xt("./antd.min.css"))},Zt=async()=>{const{theme:e}=logseq.settings;if(e==="dark")return Ge("dark");if(e==="light")return Ge("light");const o=await logseq.App.getStateFromStore("ui/theme");Ge(o)},$a=e=>{const o=document.createElement("textarea");o.value=e,document.body.appendChild(o),o.select(),document.execCommand("copy"),document.body.removeChild(o)},Fa=e=>{document.addEventListener("keyup",o=>{o.key==="Escape"&&e()})},Ua=()=>{const e=navigator.userAgent,o=e.indexOf("Windows")>-1,a=e.indexOf("Macintosh")>-1,n=e.indexOf("Linux")>-1;return o?"windows":a?"mac":n?"linux":"unknown"},Xt=e=>{const o=document.createElement("link");o.rel="stylesheet",o.href=e,o.className="antd-css";const a=document.head||document.getElementsByTagName("head")[0],n=a.childNodes[0];n?a.insertBefore(o,n):a.appendChild(o);const r=a.querySelectorAll(".antd-css");Array.from(r)?.slice(1)?.forEach(s=>{a.removeChild(s)})},gt=e=>{const o=document.querySelector("html"),a=document.querySelector("body");e?(o?.classList.add("modal-app"),a?.classList.add("modal-app")):(o?.classList.remove("modal-app"),a?.classList.remove("modal-app"))},Wa=(e,o)=>{const a=[];let n=e;for(;n.isSameOrBefore(o);)a.push(n.clone()),n=n.add(1,"day");return a},ft=(e=6)=>{const o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let a="";for(let n=0;n<e;n++)a+=o.charAt(Math.floor(Math.random()*o.length));return a},eo=e=>{const o=new URL(e).searchParams;let a={};return o.forEach((n,r)=>a[r]=n),a},Ga=e=>{const o=new Notification(e);o.onclick=()=>{o.close()}},za=async()=>{let e=[];const o=q(),{calendarList:a=[]}=o,n=a.filter(u=>u?.enabled);let r=[];r=n.map(u=>u?.query?.filter(d=>d?.script?.length)?.map(d=>({calendarConfig:u,query:d}))).filter(Boolean).flat();const s=r.map(async u=>{const{query:d}=u,{script:c="",queryType:p}=d;let g=[];p==="simple"?g=await logseq.DB.q(c)||[]:g=await logseq.DB.datascriptQuery(c);const b=he.exports.flattenDeep(g).map(C=>Ja({block:C,queryWithCalendar:u,settings:o}));return Promise.all(b)}),l=await Promise.allSettled(s),i=[];return l.forEach((u,d)=>{if(u.status==="fulfilled")i.push(u.value);else{console.error("[faiz:] === scheduleRes error: ",r[d],u);const{calendarConfig:c,query:p}=r[d],g=`Query Exec Error:
calendar: ${c.id}
query: ${p.script}
message: ${u.reason.message}`;logseq.App.showMsg(g,"error")}}),e=he.exports.flattenDeep(e.concat(i)),e},Qa=async()=>{const{logKey:e,defaultDuration:o}=q();if(!e?.enabled)return[];const r=((await logseq.DB.q(`[[${e.id}]]`))?.filter(l=>(l.headingLevel&&l.format==="markdown"&&(l.content=l.content.replace(new RegExp(`^#{${l.headingLevel}} `),"")),l.content?.trim()===`[[${e.id}]]`))?.map(l=>Array.isArray(l.parent)?l.parent:[])?.flat()?.filter(l=>(l.content?.trim()).length>0&&l?.page?.journalDay&&!l.marker&&!l.scheduled&&!l.deadline)||[])?.map(async l=>{const i=l?.page?.journalDay,{start:u,end:d}=yt(l?.content.replace(new RegExp(`^${l.marker} `),"")),c=u||d;if(!!c)return await wt({blockData:l,category:c?"time":"allday",start:u?ne(te(i+" "+u,"yyyyMMdd HH:mm",new Date)):ze(i),end:d?ne(te(i+" "+d,"yyyyMMdd HH:mm",new Date)):void 0,calendarConfig:e,defaultDuration:o,isAllDay:!c,isReadOnly:!0})});return(await Promise.all(r)).filter(Boolean)},Ja=async({block:e,queryWithCalendar:o,settings:a})=>{const{calendarConfig:n,query:r}=o,{script:s="",scheduleStart:l="",scheduleEnd:i="",dateFormatter:u,isMilestone:d,queryType:c}=r,{defaultDuration:p}=a,g=["scheduled","deadline"].includes(l||i)?Qt:u||Ba,b=he.exports.get(e,l,void 0),C=he.exports.get(e,i,void 0);let T=/[Hhm]+/.test(g||""),k,y;try{k=b&&ze(b,g),y=C&&(T?ze(C,g):ne(Ro(te(C,g,new Date))))}catch(v){return console.warn("[faiz:] === parse calendar date error: ",v,e,r),[]}if(e?.page?.["journal-day"]){const{start:v,end:D}=yt(e?.content.replace(new RegExp(`^${e.marker} `),""));if(v||D){const j=e?.page?.["journal-day"];k=v?ne(te(j+" "+v,"yyyyMMdd HH:mm",new Date)):ze(j),y=D?ne(te(j+" "+D,"yyyyMMdd HH:mm",new Date)):void 0,T=!0}}if(b&&["scheduled","deadline"].includes(l)){const v=e.content?.split(`
`)?.find(j=>j.startsWith(`${l.toUpperCase()}:`))?.trim(),D=/ (\d{2}:\d{2})[ >]/.exec(v)?.[1]||"";D&&(k=ne(te(`${b} ${D}`,"yyyyMMdd HH:mm",new Date)),T=!0)}if(C&&["scheduled","deadline"].includes(i)){const v=e.content?.split(`
`)?.find(j=>j.startsWith(`${i.toUpperCase()}:`))?.trim(),D=/ (\d{2}:\d{2})[ >]/.exec(v)?.[1]||"";D&&(y=ne(te(`${C} ${D}`,"yyyyMMdd HH:mm",new Date)),T=!0)}let N=T?"time":"allday";d&&(N="milestone");const w=N,A=to(e,y||k,!T);return!d&&A&&(N="task"),await wt({blockData:{...e,category:w,type:"project",rawStart:k,rawEnd:y,rawAllDay:!T,rawOverdue:A},category:N,start:k,end:y,calendarConfig:n,defaultDuration:p,isAllDay:!d&&!T&&!A,isReadOnly:!0})},to=(e,o,a)=>e.marker&&e.marker!=="DONE"&&e.marker!=="CANCELED"&&e.marker!=="WAITING"?a?m().isAfter(m(o),"day"):m().isAfter(m(o),"minute"):!1,yt=e=>{const o=e.match(qe);return o?{start:o[1],end:o[2]?.slice(1)}:{start:void 0,end:void 0}},Va=(e,o,a)=>{const n=`${o}${a?"-"+a:""}`;return e.match(qe)?e.replace(qe,n):n+" "+e},oo=e=>e.replace(qe,""),ao=async e=>{const o=/\(\([0-9a-z\-]{30,}\)\)/;if(o.test(e)){const a=o.exec(e)?.[0]?.replace("((","")?.replace("))","");if(a){const n=await ve({uuid:a},!0);return e.replace(o,n?.content||"")}}return e};async function wt(e){const{id:o,blockData:a,category:n="time",start:r,end:s,calendarConfig:l,isAllDay:i,defaultDuration:u,isReadOnly:d}=e;if(!a?.id){const w=await ve({uuid:a.uuid?.$uuid$},!0);w&&(a.id=w.id)}let c=a?.page;he.exports.has(c,"id")&&he.exports.has(c,"name")&&he.exports.has(c,"original-name")&&(c={id:c.id,journalDay:c["journal-day"],journal:c["journal?"],name:c.name,originalName:c["original-name"]}),a.page=c,a.fullContent=await ao(a.content);const p=window.logseqAppUserConfigs?.preferredFormat==="org"?Fe:$e,g=a.fullContent.split(`
`)[0]?.replace(new RegExp(`^${a.marker} `),"")?.replace(qe,"")?.replace(p,"")?.replace(" #milestone","")?.trim?.(),b=a.marker==="DONE";function C(){return!!(a.page?.properties?.agenda===!0||a?.page?.["journal-day"]&&!a?.scheduled&&!a?.deadline)}const T=d===void 0?C():!d,k=u||q()?.defaultDuration;let y=s;(n==="time"||a?.category==="time")&&!s&&r&&k&&(y=m(r).add(k.value,k.unit).format()),a?.category!=="time"&&!s&&(y=r);const N=typeof a?.uuid=="string"?a?.uuid:a?.uuid?.$uuid$;return a.uuid=N,{id:o||N,calendarId:l.id,title:g,body:a.fullContent,category:n,dueDateClass:"",start:r,end:y,raw:a,color:l?.textColor,bgColor:l?.bgColor,borderColor:l?.borderColor,isAllDay:i,customStyle:b?"opacity: 0.6;":"",isReadOnly:!T}}const ze=(e,o=Qt)=>ne(te(""+e,o,new Date)),ge=(e=[])=>({waiting:e.filter(o=>o?.addOns?.status==="waiting"),todo:e.filter(o=>o?.addOns?.status==="todo"),doing:e.filter(o=>o?.addOns?.status==="doing"),done:e.filter(o=>o?.addOns?.status==="done"),canceled:e.filter(o=>o?.addOns?.status==="canceled")}),Ka=e=>{const o=new Map;return e.forEach(a=>{const n=m(a.addOns.start).startOf("day").format();o.has(n)||o.set(n,[]),o.get(n)?.push(a)}),o},Za=({start:e,end:o,allDay:a})=>{const n=new URL("agenda://");n.searchParams.append("start",""+e.valueOf()),n.searchParams.append("end",""+o.valueOf()),a===!1&&n.searchParams.append("allDay","false");const r=a?e.format("YYYY-MM-DD"):e.format("YYYY-MM-DD HH:mm");let s=a?o.format("YYYY-MM-DD"):o.format("YYYY-MM-DD HH:mm");const l=e.isSame(o,"day");l&&a&&(s=""),l&&!a&&(s=o.format("HH:mm"));const i=r+(s?` - ${s}`:"");return window.logseqAppUserConfigs?.preferredFormat==="org"?`>[[#${n.toString()}][${i}]]`:`>[${i}](#${n.toString()})`},Xa=e=>{const o=window.logseqAppUserConfigs?.preferredFormat==="org"?Fe:$e,a=e.match(o);return!a||!a?.[1]?null:eo(a[1])},no=e=>{const o=window.logseqAppUserConfigs?.preferredFormat==="org"?Fe:$e;return e.replace(o,"")},bt=(e,o)=>{const a=window.logseqAppUserConfigs?.preferredFormat==="org"?Fe:$e,n=Za(o),r=oo(e)?.trim();return a.test(r)?r.replace(a,n):r?.split(`
`).map((s,l)=>l===0?s+" "+n:s).join(`
`)};function ro(e){let o=[],a=[],n=[];return e.forEach(r=>{r.addOns.isOverdue?o.push(r):r.addOns.allDay?a.push(r):n.push(r)}),{overdueTasks:o,allDayTasks:a,timeTasks:n}}function so(e){let o=[],a=[];return e.forEach(n=>{n.isAllDay?o.push(n):a.push(n)}),{allDaySubscriptions:o,timeSubscriptions:a}}const en=e=>/ #milestone/.test(e.content)||/ #\[\[milestone\]\]/.test(e.content),lo=async(e,o,a)=>{const n=await logseq.Editor.getBlock(e);if(!n)return logseq.App.showMsg("Block not found","error"),Promise.reject(new Error("Block not found"));o&&await logseq.Editor.updateBlock(n.uuid,o);const r=Object.keys(a||{}).map(s=>logseq.Editor.upsertBlockProperty(n.uuid,s,a?.[s]));return Promise.allSettled(r)},io=async(e,o)=>{const a=await logseq.Editor.createPage(o);return a?(await logseq.Editor.moveBlock(e,a.uuid),await ve({uuid:e})):logseq.App.showMsg("Create page failed","error")},kt=async(e,o,a)=>{const r=await ve(typeof e=="number"?{id:e}:{uuid:e});if(!r)return logseq.App.showMsg("moveBlockToSpecificBlock: Block not found","error");let s=await de({originalName:o});s||(s=await logseq.Editor.createPage(o));let l=await mo(o,a);return l||(l=await logseq.Editor.insertBlock(o,a,{before:!0,isPageBlock:!0})),l&&await logseq.Editor.moveBlock(r.uuid,l.uuid,{children:!0}),await ve({uuid:r.uuid})},co=async(e,o,a,n={})=>{let r=await de({originalName:e});r||(r=await logseq.Editor.createPage(e));let s=await mo(e,o);return s||(s=await logseq.Editor.insertBlock(e,o,{before:!0,isPageBlock:!0})),await logseq.Editor.insertBlock(s.uuid,a,{isPageBlock:!1,properties:n,sibling:!1,before:!1})},Qe=new Map,ve=async(e,o=!1)=>{const{id:a,uuid:n}=e,r=a||n;if(!r)return Promise.reject(new Error("getBlockData: id or uuid is required"));if(o&&Qe.has(r))return Qe.get(r);const s=await logseq.Editor.getBlock(r);if(!s)return null;const{id:l,uuid:i}=s;return Qe.set(l,s),Qe.set(i,s),s},Pe=new Map,de=async(e,o,a=!1)=>{const{id:n,uuid:r,originalName:s}=e,l=n||r||s;if(!l)return Promise.reject(new Error("getPageData: id, uuid or pageOriginalName is required"));if(a&&Pe.has(l))return Pe.get(l);const i=await logseq.Editor.getPage(l,o);if(!i)return null;const{id:u,uuid:d,originalName:c}=i;return Pe.set(u,i),Pe.set(d,i),Pe.set(c,i),i},uo=async()=>{const e=await logseq.App.getStateFromStore("ui/theme"),o=logseq.settings?.theme==="auto"?e:logseq.settings?.theme,a=logseq.settings?.lightThemeType||"green";return o==="dark"?"dark":a},mo=async(e,o)=>(await logseq.Editor.getPageBlocksTree(e)).find(r=>r.content===o)||null,tn=e=>{let o=null;for(let a=0;a<e.length;a++){const n=e[a],r=n.getAttribute("blockid");if(n?.className?.includes("block-content")&&r){o=r;break}a++}return o},po=(e,o)=>{const a=e.marker,n=e.priority;return(o||e.content)?.replace(a,"").trim().replace(`[#${n}]`,"").trim()},Je=(e,o)=>{const a=e.marker,n=e.priority;let r=o;return n&&(r=`[#${n}] `+r),a&&(r=a+" "+r),r};let vt=new Map;const on=(e,o=2e3)=>({blocks:a,txData:n,txMeta:r})=>{const{marker:s,properties:l,uuid:i}=a[0];if(!s||!l?.todoistId||!i)return;const u=vt.get(i);u&&clearInterval(u),vt.set(i,window.setInterval(async()=>{if(await logseq.Editor.checkEditing()!==i){const c=vt.get(i);clearInterval(c),e(i)}},o))},q=(e={filterInvalideProject:!0})=>{const{filterInvalideProject:o}=e;let a=K.logKey;const n=logseq.settings?.logKey;n&&(a=n,typeof n=="string"&&K.logKey&&(a={...K.logKey,id:n}));const r=logseq.settings?.projectList||K.projectList;return{...K,...logseq.settings,logKey:a,projectList:o?r?.filter(s=>Boolean(s.id)):r}},an=()=>{if(!logseq.settings?.initialized){const o=q();logseq.updateSettings({...o,initialized:!0})}},nn=async()=>{const o=await uo()==="dark"?"dark":"light";let a=logseq.settings?.defaultView||"month";return logseq.settings?.defaultView==="2week"&&(a="month"),{defaultView:a,taskView:!0,scheduleView:!0,useDetailPopup:!0,isReadOnly:!1,disableClick:!0,theme:Ya[o],usageStatistics:!1,week:{startDayOfWeek:logseq.settings?.weekStartDay||0,hourStart:logseq.settings?.weekHourStart||0,hourEnd:logseq.settings?.weekHourEnd||24},month:{startDayOfWeek:logseq.settings?.weekStartDay||0,scheduleFilter:n=>Boolean(n.isVisible),visibleWeeksCount:logseq.settings?.defaultView==="2week"?2:void 0},template:{taskTitle:()=>'<span class="tui-full-calendar-left-content">Overdue</span>',task:n=>"\u{1F525}"+n.title,timegridDisplayPrimayTime:function(n){return n.hour<10?"0"+n.hour+":00":n.hour+":00"},popupDetailBody:n=>{const r=`<br/><b>Calendar: ${n.calendarId}</b>`,s=n.raw?.subscription?"":'<br/><a id="faiz-nav-detail" href="javascript:void(0);">Navigate To Block</a>';return`
          <div class="calendar-popup-detail-content">
            ${n.body?.split(`
`).join("<br/>")}
          </div>
          ${r}
          ${s}
        `}}}},rn=e=>({...e,defaultView:"week",taskView:["time"]}),sn=e=>({id:e,bgColor:"#b8e986",textColor:"#4a4a4a",borderColor:"#047857",enabled:!0,query:[{script:`
[:find (pull ?block [*])
:where
[?block :block/marker ?marker]
[(missing? $ ?block :block/deadline)]
(not [(missing? $ ?block :block/scheduled)])
[?page :block/name ?pname]
[?block :block/page ?page]
[(contains? #{"${e}"} ?pname)]
[(contains? #{"TODO" "DOING" "NOW" "LATER" "WAITING" "DONE"} ?marker)]]
        `,scheduleStart:"scheduled",dateFormatter:"yyyyMMdd"},{script:`
[:find (pull ?block [*])
:where
[?block :block/marker ?marker]
[(missing? $ ?block :block/scheduled)]
[(get-else $ ?block :block/deadline "nil") ?d]
[(not= ?d "nil")]
[?page :block/name ?pname]
[?block :block/page ?page]
[(contains? #{"${e}"} ?pname)]
[(contains? #{"TODO" "DOING" "NOW" "LATER" "WAITING" "DONE"} ?marker)]]
        `,scheduleStart:"deadline",dateFormatter:"yyyyMMdd"},{script:`
[:find (pull ?block [*])
:where
[?page :block/name ?pname]
[?block :block/page ?page]
[(contains? #{"${e}"} ?pname)]
[?rp :block/name "milestone"]
[?block :block/refs ?rp]]
        `,scheduleStart:"scheduled",dateFormatter:"yyyyMMdd",isMilestone:!0}]}),ln=e=>({id:e,bgColor:"#b8e986",textColor:"#4a4a4a",borderColor:"#047857",enabled:!0,query:[{script:`(and (page "${e}") (task todo doing done later now waitting) (property end) (property start))`,scheduleStart:"properties.start",scheduleEnd:"properties.end",dateFormatter:"yyyy-MM-dd",queryType:"simple"},{script:`(and (page "${e}") (task todo doing done later now waitting) (property end) (property start))`,scheduleStart:"properties.start",scheduleEnd:"properties.end",dateFormatter:"yyyy-MM-dd HH:mm",queryType:"simple"},{script:`(and (page "${e}") [[milestone]] (property start))`,scheduleStart:"properties.start",dateFormatter:"yyyy-MM-dd",queryType:"simple",isMilestone:!0}]});var dn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAAAXNSR0IArs4c6QAADHpJREFUeF7tnXlwG9Udx797yJIsW7ZjTOwcTogdhyPN6Rx2m2CHkIZAuQkQjoEBWmC4WtrSdso9TMtAgULLDKTMdCg3JIGGAikYhyMk0NCSBGgwEJL4kC+k+JSsazsrx0U+tbvvPeHlPf3lsX6/3/u97++zvz20+1aC+HCtgMT17MXkIQDgHAIBgACAcwU4n77oAAIAzhXgfPqiAwgAOFeA8+mLDiAA4FwBzqcvOoAAgHMFOJ++6AACAM4V4Hz6ogMIADhXgPPpj7sOUPP2rgWejMwvli6d2cm6Nq/V7Lw8JssfnVy9YCfrsV6p2VkCOdq3pnppA+uxzMQfNwDUbt9zJWK4FRIKD0/gyervf+9CM5MxavvGu3tOVCQ8HIvFSoOhIGRF7jr5hCVeo/5m7F59Y8ecaFx7FsDRCT9J2u6IxU9ZvbrSbyYOK9txA8DWbXu2aUBl8kQlSVpXVTn7adqTHxgrFotBB0D/OBwZf1pdvfBa2mO9vGXHPZqk/Tw5rqbhoVN/WHEd7bGsxBs3ANRu26MNnUA8Hr/9hGVzb7MysbF8BsZKBkBV1a0nrVhUTXuszf/cXgugakjcrT9aVUF9LCu5CwAOdwABgBV8KPqIDkBRTBOhmHaAlvMqKqNxaZUErVyTUCLF0Txabp/d8OjQNoncj97cP3HrM/tNzMeQ6cBYybuArNaG6KSN67sNBTBhVH/6ZVnBwmI12cXdfDA69cXHRh1Lg6TIUrxRQfw9TcMTpRtr9N0Ikw8TAJrOqVinSfgZgIVGs667/tFhpvk7NiP//c1GQxi2GxhrEADN9Thy018NxzBq6DvtYgQnTRtk7m46gKKXHjcaAg4pUu+QwjcdteEt6gfE1AFoWLv0BQnSWYZnd9hQADC2YhI0ZMjh2tINNSvMajuWPVUAGtZW3C8BN1hJUABgTDWnHHq6dMOb64xZp7aiBkDL+UvmRGPyrtRDjmwhADCunCpFzpy18fVNxj1Gt6QGQNO5lQ9rmnaV1aQEAMaVU6R4w9EbX5tq3CMNADSurRh2IcdMggIA42rpxwPHbnqVysZLJciBc5YsVCWZ6AcVAYBxAHRLt9q3asbzNa+b8xpuTQWAxrUV5wN4iiQZAYA59dxK8M4ZL9TeYs5rHAPQeNp16Jk+e1CGk196EJ79H5POcZh/0ylXo7tkHpKvAxzx4TvwfrCV+liB8uUILDp+UNy8f72FvJ1vE431nQOgt/hYHJpThd4pZXC11cPdUMfkIpCuejR7Atorz0DHtNnoi0SQ0eFH4bOPEBVkNGfNkYH2ZasTF4PkSATu+i+R/x5x58Z3DgAm6qcI2pNThEh76NsYmnhMAQCxhEBUU9EdzaYQKf0hBAAUNBcAgM4SMTTOAijU03QIAYAAQOwCTG82IziIDkBDRXMxxDGAOb1GtBa7AEq7gPoLqi6UI31/o1CTtIawMwAuj3R3yRP/+BWpYFQuBTfd9Zs7tF21N5Mmk25/WwMwb/6rJbfetYZUMwGATa8DqGvOemzWFZddPv4AUB2kOaXNPxpT0B12p208mgOpZ1/651kXnHMNaUwqHaC+TatSFDC7c5V0kqP5J34MCvayCs80rqKqPy2ZlPkA6SACAAEAKUOA6ADkGpqNIDqAWcVGsBe7AFrXAcQxAAUczYUQHWAEveRIK5RQPeS+Buh/J3+iWfMRzZwFTfnm59+ROoAr8C7c/m1Qgr5B/pHsMkQ8MxHOno2os8hctRhYCwAOiyrFw8gIbIHTvwWOrg9SSh31zEE4dxlC+WcgKnkSZwFZjU/B43sFcncTEI2ljBHPKUKwaDU6p1yS0paVgQBAvzPWtz5ReKXvoHmdJQV9jsWQDrwPRMLm/XUPtwehomoEZvzCmj+BF9cA6Fu9p/5uOL8me3BU69MQaUm9xaeqUzx3ClrKn0xlRvV7bgFQe/ciZ+/FVMSkBUAiGVWBr+pNKnkZCcIlAEpoH3I/Pc+IPoZsqAKgj5jhgG/5G4bGJjXiDgAp2oncvRdCDo+6xoRpTakDoN9yXlCGtrnrTedi1oE7ALL3/RIZh+g+uMECAL2QkcL5aJ9NfJl+TCa4AiAjUIPsr35tdiNJac8KAMgS/OX3o887P2UOVg24AsBb9xM4uv9jVatR/ZgBkIZdATcAuNpfgufgXdSLrwdkCYB+w33HvJvRm7+SSe7cAJC97yZkHGJzqwFTAAD0FVfBX3a7AMCqAvoFn7zdKyHF2Ty/xxqAeO4ktJRTX9grIScXHcDR+QG8XxDf9fStHAMkBmV4XYALAPRr/Zk+dufUrDuAzkDzitehyRlWm+CofgIACpKmA4D2HzyOiGvwQpEUUudjF/Bd6ACBRfcilLOIRs0HxRAdgIKk6egAnXNvQk8B8fMbw2bLBQCutufhqb+HQqlHDpEOAAKL70PIa3jJZMNz5QIAR+d2eL+43rAoZg2ZA6DI8FWzuYbBBQBKaD9yP11rtq6G7VkDoGXno3nJRsP5mDHkAgD9QlDuJ6dDjrSb0cawLWsAWP4qyAUAeiVZngkwBUACAuV/QCin3DCQZgy5AUDf+vVbwFh0AZYAxPOmomXhE2ZqasqWGwBYdgGWAHQddxW6i+jdvjaUDq4AkMMtidvBpGiHqa0klTErADRvAZoXv5BqeKLvuQJAV8rT8ABcrUTrUQ8TnBUAXcddh+4i02/NMQUEdwAowc+R+98LTImUypgFAPEJ09CywPgLoVLlONr33AGgC+GtuxKO7n9b1SwtHaBn1iXonHoptRwFAEkK0D4lpN4BZAm+FXTvXBYAJCkw3h8MiecUomWR/qJw9h8udwG6rBP0W8SinVQUpt0BWN4DyPVpYPLkcz67FGrPJ+MSgJ5jLkPnZDrPLaaaILcdIGv/LXD6X0ulT8rvQ0euQ0/+2UDDFnia/g45UJ/SJ5UBq59+RxqXWwBoHAh2HfU7hPNO6H9n0OFVwoq2nwr0kF1o8q18KxUj1L7nFgBX6zPwNNxHJKR/bi00xTMIgIJdV0Btq7MeN41nAHqS3ALg9L+CrP23WS8UgK8X9C8lk9wBjvj4BjiaCR4/c6jwHV9DlJcZZ24ByOh4B9lf3mhGq2G2TABwuuBbtoUoLzPO3ALg6PoQ3s8tv6I4oTELALTMbDRXvmymhkS2AgAC+QQA34hnu7WCRQfoLx63HUDt/Qw5ey+yvP1rshP+ee8MOwjM3/tbZDT0/9/KR8vKQ/PSF624WvLhFgBdrQkfLbf8xHDMXYpDx/TfV5B8FuBp3Qzv7nstFSMR64iZaJ33F8v+Zh25BsD7+TWGVgUdSdRwbjW6Ztw9DAA5EsDEt08HNLOl6LcPFx+Pr8vusOZswYtrADIbH4S7xdoNl8GJF6N3cv8j50PXCi7atgYI9lgoB5Cu+wAGkuMaAP0ewZy6H0MOD17QOVXlop7Z6Cz94/8XjB4KQM7B9cisMw9WLK8YrQvT+9I0rgHQC2125TBNdqOz7NHEiuEDn5FWCy/YfTXUVhO/Nro9aKl4EXEGawCMBTT3AOjiuNo2wNX2HJTQV2Nu/FHPXAQLL0I4Z/kgu9FeGFGw51qobXuA+NgHBPoNIB0zb0Qod3Gq5kP9ewHAYUmlWE8CAr0jqKF9gBbt/0ZyIOouQTjvRAQnjnzaONYbQ1yHdsD71SNQOuuBSOSbAsoS4MxEcPJJODT9WuqFNRpQADCSUloUSugAICmIOacAkjqmnkZfGaOE2+Dq+BBRVxH6sucarRFTOwEABXmNAkBhKOohBAAUJBUAUHpplK9LO1aLwMShM4XqUQhhZwBk1Xlm6STnJlIZqPwYpGmayxdAkDSZdPvbGQCnlj1h2jQpQKoZFQD0JHx+7WMNOI40oXT62xUASZLDM6dmOWloRROAhzSA3bKeNGY7JIZdAVAV9f0ZkzOX0pCEGgB6Mk1+7QCAYhqJpSOGHQGQZbm9dEpWAS19qAJgt4NBOwJQVuylWjOqwRLHAj6tQHPiOQBVtChlFcdOAKiq48CMSe7ptLWgDsBAgo1+7ffQcKYkYSbtpGnFswMAsqz0Kor08lFFmefSmndyHGYADAzypV/LyYxjVlRDJosJkMQMR4LzSPxZ+iqytHt6oZv5iwiZA8BSJBGbXAEBALmGto4gALB1+ciTFwCQa2jrCAIAW5ePPHkBALmGto4gALB1+ciTFwCQa2jrCAIAW5ePPHkBALmGto4gALB1+ciTFwCQa2jrCAIAW5ePPHkBALmGto4gALB1+ciTFwCQa2jrCAIAW5ePPPn/AeXG+9voOJDHAAAAAElFTkSuQmCC";const cn="_container_1xwon_1",un="_buttonWrapper_1xwon_4",mn="_button_1xwon_4",pn="_active_1xwon_19",hn="_indicatorBack_1xwon_23",gn="_indicatorDot_1xwon_34";var xe={container:cn,buttonWrapper:un,button:mn,active:pn,indicatorBack:hn,indicatorDot:gn};const fn=({initialValue:e,onChange:o,tabs:a})=>{const[n,r]=x.exports.useState(e||a?.[0]?.value),s=a.findIndex(({value:i})=>i===n)*100,l=i=>{r(i),o?.(i)};return h("div",{className:xe.container,children:[a.map(({label:i,value:u,icon:d})=>t("div",{className:xe.buttonWrapper,onClick:()=>l(u),children:t("div",{className:`${xe.button} ${u===n?xe.active:""}`,title:i,children:d})},u)),t("div",{className:xe.indicatorBack,style:{transform:`translateX(60px) translateY(${s}%)`}}),t("div",{className:xe.indicatorDot,style:{transform:`translateY(${s}%)`}})]})},yn="_container_1ph2e_1",wn="_logo_1ph2e_6",bn="_close_1ph2e_16";var xt={container:yn,logo:wn,close:bn};const kn=({defaultRoute:e,menus:o})=>{const a=Bt(),{homePage:n=K.homePage}=q(),r=s=>{const{path:l}=o.find(i=>i.value===s)||{path:"/"};a(l)};return x.exports.useEffect(()=>{e&&a(e)},[e]),h("div",{className:xt.container,children:[t("div",{className:xt.logo,children:t("img",{src:dn})}),t(fn,{tabs:o,onChange:r,initialValue:n}),t("div",{className:xt.close,onClick:()=>logseq.hideMainUI(),children:t(Lt,{})})]})};function ce(){const[e,o]=x.exports.useState(K.lightThemeType);return x.exports.useEffect(()=>{uo().then(a=>{o(a)})}),e}const vn={green:{lineColor:"#058f68",backColor:"rgba(5, 143, 104, 0.8)",backColorEnd:"rgba(255,255,255,0)"},purple:{lineColor:"#3a4de9",backColor:"rgba(58,77,233,0.8)",backColorEnd:"rgba(255,255,255,0)"},dark:{lineColor:"#d19811",backColor:"rgba(148, 108, 12, 0.8)",backColorEnd:"rgba(33, 37, 40, 0.8)"}},xn={green:{backColor:"#e9f2f0",lineColor:"#058f68",shadowColor:"rgba(5, 143, 104, 0.8)",colorPrimary:"#333",colorSecondary:"#777"},purple:{backColor:"#f2f6ff",lineColor:"#5146a0",shadowColor:"rgba(58,77,233,0.8)",colorPrimary:"#333",colorSecondary:"#777"},dark:{backColor:"#212528",lineColor:"#d19811",shadowColor:"rgba(33, 37, 40, 0.8)",colorPrimary:"#fafafe",colorSecondary:"#aaadb3"}},Cn=Ua(),ho=({progress:e=0,uniqueId:o="",height:a=160,type:n="primary"})=>{const r=x.exports.useRef(),s=ce();return x.exports.useEffect(()=>{const l=document.getElementById("gauge"+o);async function i(){if(!l||!s)return;const u=xn[s],d=n==="normal"?20:60,c=n==="normal"?4:7,p={series:[{type:"gauge",startAngle:90,endAngle:-270,min:0,max:100,splitNumber:12,grid:{left:"0",right:"0",bottom:"0",containLabel:!0},itemStyle:{color:u.lineColor,shadowColor:u.shadowColor,shadowBlur:n==="normal"?3:10,shadowOffsetX:n==="normal"?0:2,shadowOffsetY:n==="normal"?0:2},progress:{show:!0,roundCap:!0,width:c},pointer:{show:!1},axisLine:{roundCap:!0,lineStyle:{width:c,color:[[1,u.backColor]]}},axisTick:{show:!1},splitLine:{show:!1},axisLabel:{show:!1},title:{show:!1},detail:{show:!0,width:d,height:d,lineHeight:d+(Cn==="windows"?4:0),borderRadius:100,offsetCenter:[0,0],valueAnimation:!0,formatter:function(g){return"{value|"+g.toFixed(0)+"}{unit|%}"},rich:{value:{fontSize:n==="normal"?15:34,color:u.colorPrimary},unit:{fontSize:n==="normal"?10:15,color:u.colorSecondary,padding:n==="normal"?[0,0,-2,1]:[0,0,-8,2]}}},data:[{value:e}]}]};window.requestAnimationFrame(()=>{const g=Le(l);r.current=g,g.setOption(p)})}return i(),()=>{r.current&&r.current.dispose()}},[e,s]),t("div",{children:t("div",{id:"gauge"+o,style:{width:"100%",height:a+"px"}})})},Dn=({data:e})=>{const o=x.exports.useRef(),a=ce();return x.exports.useEffect(()=>{const n=document.getElementById("polygonal");async function r(){if(!n||!a)return;const s=vn[a],l={xAxis:{type:"category",data:e.map(i=>{const u=m(i.date).format("DD");return u==="01"?m(i.date).format("MM.DD"):u}),axisTick:{show:!1},axisLine:{show:!1}},yAxis:{type:"value",splitLine:{show:!1},minInterval:1},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},series:[{data:e.map(i=>i.value),type:"line",smooth:!0,emphasis:{focus:"series"},showSymbol:!1,itemStyle:{color:s.lineColor},areaStyle:{color:new Yo(0,0,0,1,[{offset:0,color:s.backColor},{offset:1,color:s.backColorEnd}])}}]};window.requestAnimationFrame(()=>{const i=Le(n);o.current=i,i.setOption(l)})}return r(),()=>{o.current&&o.current.dispose()}},[e,a]),t("div",{id:"polygonal",style:{height:"240px",width:"100%"}})},go=`
  .external-link[href^="#agenda://"]::before {
    content: '\u{1F4C5}';
    margin: 0 4px;
  }
  .agenda-sidebar-task__add {
    display: none;
  }
  .agenda-sidebar-task:hover {
    opacity: 1;
  }
  .agenda-sidebar-task:hover .agenda-sidebar-task__add {
    display: flex;
  }
  .agenda-sidebar-task:hover .agenda-sidebar-task__title {
    color: var(--ls-link-text-color);
  }

  .external-link[href^="#agenda-pomo://"]::before {
    display: none;
  }
  .external-link[href^="#agenda-pomo://"] {
    font-weight: 600;
    border: 1px solid #0F9960;
    background: #defcf0;
    border-radius: 4px;
    padding: 1px 6px;
    color: #222;
    white-space: nowrap;
  }
  .dark .external-link[href^="#agenda-pomo://"] {
    background-color: #1a543b;
    color: #ddd;
  }

  .agenda-toolbar-pompdoro {
    height: 1.5rem;
    width: 62px;
    line-height: 1.5rem;
    font-size: 14px;
    font-weight: 600;
    border-radius: 0.3rem;
    margin: 0 0.125rem;
    color: #cd3838;
    border: 1px solid #cd3838;
    text-align: center;
    position: relative;
  }
  .agenda-toolbar-pompdoro .timer-progress-back {
    width: 0;
    height: 100%;
    background: #f6dbdb;
    position: absolute;
    z-index: -1;
    left: 0;
    top: 0;
    transition: width 0.5s;
  }
  .dark .agenda-toolbar-pompdoro .timer-progress-back {
    background-color: #a69494;
  }
  .agenda-toolbar-pompdoro.break {
    color: #0F9960;
    border-color: #0F9960;
  }
  .agenda-toolbar-pompdoro.break .timer-progress-back {
    background-color: #defcf0;
  }
  .dark .agenda-toolbar-pompdoro.break .timer-progress-back {
    background-color: #1a543b;
  }
  .agenda-toolbar-pompdoro.hide {
    display: none;
  }
`,Ve={bgColor:"#b8e986",textColor:"#4a4a4a",borderColor:"#047857"},fo=(e,o,a,n=!1)=>`<div data-on-click="showPomodoro" class="agenda-toolbar-pompdoro ${n?"break":""}" data-uuid="${e}">
    ${o}
    <div class="timer-progress-back" style="width: ${a*100}%;"></div>
  </div>`,Ct=(e=!0)=>{const o=document.querySelector("#pomodoro-root");o&&e&&o.classList.remove("hide"),o&&!e&&o.classList.add("hide")},yo=(e,o)=>{const a=o==="markdown"?Ue:We,n=e.match(a);if(!n||!n?.[1])return null;const s=eo(n[1]).t;return s?s.split(",").map(i=>{const u=i.split("-"),[d,c,p,...g]=u,b=g.join("-"),C=g?.length>0?b.split(Vt):[];return{isFull:d==="f",start:parseInt(c),length:parseInt(p),interruptions:C.map(T=>({type:Number(T?.[0]),time:Number(T.substring(1,14)),remark:T.substring(14)}))}}):null},Dt=async(e,o,a="addon")=>{const n=await logseq.Editor.getBlock(e);if(!n)return;let r=[].concat(o);a==="addon"&&(r=(yo(n.content,n.format)||[]).concat(o));const s=r.map(T=>{const{isFull:k,start:y,length:N,interruptions:w}=T,A=k?"f":"p",S=w?.map(v=>{const{type:D,time:j,remark:P}=v;return`${D}${j}${P}`}).join(Vt);return`${A}-${y}-${N}${S?`-${S}`:""}`}).join(","),l=new URL("agenda-pomo://");l.searchParams.append("t",s);const i=r.reduce((T,k)=>T+k.length,0),d=`${r.filter(T=>T.isFull)?.map(()=>"\u{1F345}")?.join("")||"\u{1F345}"} ${Math.ceil(i/60)}min`,c=n?.format==="org"?`>[[#${l.toString()}][${d}]]`:`>[${d}](#${l.toString()})`,[p,...g]=n.content?.split(`
`)||[];let b=p;const C=n.format==="markdown"?Ue:We;return C.test(n.content)?b=p.replace(C,c):b=`${p} ${c}`,`${b}
${g.join(`
`)}`},Tn=(e,o)=>{const a=o==="markdown"?Ue:We;return e.replace(a,"")?.trim()},Ke=e=>{const{journal:o,projectList:a=[]}=q();let n=e?.addOns?.allDay?"allday":"time";e?.addOns?.isOverdue&&(n="task");let r=e?.addOns?.isJournal?o:a.find(s=>s.id===e?.addOns?.project);return r||(r=Ve),{id:e.uuid,calendarId:e.addOns.isJournal?"Journal":e.addOns.project,title:e.addOns.showTitle,body:e.content,category:n,dueDateClass:"",start:e.addOns.start,end:e.addOns.end,raw:e,color:r?.textColor,bgColor:r?.bgColor,borderColor:r?.borderColor,isAllDay:!e?.addOns?.isOverdue&&e.addOns.allDay,customStyle:e.addOns.status==="done"?"opacity: 0.6;":"",isReadOnly:!1}},Ze=e=>{const{journal:o,projectList:a=[]}=q();let n=e?.addOns?.isJournal?o:a.find(r=>r.id===e?.addOns?.project);return n||(n=Ve),{id:e.uuid,calendarId:e.addOns.isJournal?"Journal":e.addOns.project,title:e.addOns.showTitle,body:e.content,category:"milestone",dueDateClass:"",start:e.addOns.start,end:e.addOns.end,raw:e,color:n?.textColor,bgColor:n?.bgColor,borderColor:n?.borderColor,isAllDay:!1,customStyle:e.addOns.status==="done"?"opacity: 0.6;":"",isReadOnly:!1}},wo=e=>{const o=m(e.addOns.start),a=m(e.addOns.end);return{id:e.uuid,title:e.addOns.showTitle,start:o.format("YYYY-MM-DD"),end:a.format("YYYY-MM-DD"),raw:e,completed:e.addOns.status==="done",detailPopup:h("div",{className:"text-xs",children:[t("div",{className:"font-bold text-base my-2",children:e.addOns.showTitle}),t("div",{className:"my-2",children:`${o.format("YYYY.MM.DD hh:mm a")} - ${a.format("hh:mm a")}`}),t("p",{className:"whitespace-pre-line",children:e.content}),t("a",{onClick:async()=>{const{id:n,originalName:r}=e.page||{};let s=r;s||(s=(await de({id:n}))?.originalName),logseq.Editor.scrollToBlockInPage(s,e.uuid),logseq.hideMainUI()},children:"Navigate to block"})]})}},oe=async(e,o)=>{const{defaultDuration:a,journal:n,projectList:r}=o,s=e?.page?.originalName?e.page:await logseq.Editor.getPage(e.page.id);e.page=s;const l=An(e),i=yo(e.content,e.format),u=en(e),d=e.refs?.find(C=>C.originalName===e.properties?.project?.[0]),c=Boolean(d?d?.journalDay:s?.journalDay);let p=l?{...e,rawTime:l,addOns:{showTitle:"",project:"Journal",contentWithoutTime:"",end:"",status:"todo",isOverdue:!1,isJournal:!1,type:"task",...l}}:{...e,addOns:{showTitle:"",project:"Journal",contentWithoutTime:"",status:"todo",isOverdue:!1,isJournal:!1,type:"task"}},g=po(e);if(l?.timeFrom==="customLink"&&(g=no(g.trim())),l?.timeFrom==="journal"&&!l?.allDay&&(g=oo(g.trim())),l?.timeFrom==="refs"){const{preferredDateFormat:C}=await logseq.App.getUserConfigs(),T=X(m(l.start).valueOf(),C);g=g.replace(`[[${T}]]`,"")?.trim()}p.addOns.contentWithoutTime=g,i&&(g=Tn(g,e.format)),p.addOns.showTitle=await ao(g?.split(`
`)?.[0]?.trim()),l&&!l.end&&(l.allDay?p.addOns.end=l.start:p.addOns.end=m(p.addOns.start).add(a.value,a.unit).format()),["DOING","NOW"].includes(e.marker)?p.addOns.status="doing":e.marker==="WAITING"?p.addOns.status="waiting":e.marker==="DONE"?p.addOns.status="done":e.marker==="CANCELED"&&(p.addOns.status="canceled"),l&&to(e,p.addOns.end,l?.allDay)&&(p.addOns.isOverdue=!0),c&&(p.addOns.isJournal=!0),u&&(p.addOns.type="milestone"),p.addOns.pomodoros=i||[],p.addOns.project=c?"Journal":d?.originalName||s?.originalName,p.addOns.projectPage=d||s;const b=r?.find(C=>C.id===p.addOns.project);return b?p.addOns.calendarConfig=b:c?p.addOns.calendarConfig=n:p.addOns.calendarConfig={id:p.addOns.project,enabled:!0,...Ve},p},An=e=>{const{start:o,end:a}=e.properties||{};if(o&&a)return o?.length>=16?{start:m(o,"YYYY-MM-DD HH:mm").format(),end:m(a,"YYYY-MM-DD HH:mm").format(),allDay:!1,timeFrom:"startProperty"}:{start:m(o,"YYYY-MM-DD").format(),end:m(a,"YYYY-MM-DD").format(),allDay:!0,timeFrom:"startProperty"};const n=Xa(e.content),r=n?.start?.length===13?Number(n.start):n?.start,s=n?.end?.length===13?Number(n.end):n?.end;if(n)return{start:m(r).format(),end:m(s).format(),allDay:n.allDay!=="false",timeFrom:"customLink"};if(e.scheduled){const u=e.content?.split(`
`)?.find(c=>c.startsWith("SCHEDULED:"))?.trim(),d=/ (\d{2}:\d{2})[ >]/.exec(u)?.[1]||"";return d?{start:m(`${e.scheduled} ${d}`,"YYYYMMDD HH:mm").format(),allDay:!1,timeFrom:"scheduledProperty"}:{start:m(""+e.scheduled,"YYYYMMDD").format(),allDay:!0,timeFrom:"scheduledProperty"}}if(e.deadline){const u=e.content?.split(`
`)?.find(c=>c.startsWith("DEADLINE:"))?.trim(),d=/ (\d{2}:\d{2})[ >]/.exec(u)?.[1]||"";return d?{start:m(`${e.deadline} ${d}`,"YYYYMMDD HH:mm").format(),allDay:!1,timeFrom:"deadlineProperty"}:{start:m(""+e.deadline,"YYYYMMDD").format(),allDay:!0,timeFrom:"deadlineProperty"}}const l=e.refs?.find(u=>Boolean(u?.journalDay));if(l)return{start:m(l?.journalDay+"","YYYYMMDD").format(),allDay:!0,timeFrom:"refs"};if(Boolean(e?.page?.journalDay)){const u=po(e),{start:d,end:c}=yt(u);return d&&c?{start:m(`${e?.page?.journalDay} ${d}`,"YYYYMMDD HH:mm").format(),end:m(`${e?.page?.journalDay} ${c}`,"YYYYMMDD HH:mm").format(),allDay:!1,timeFrom:"journal"}:d&&!c?{start:m(`${e?.page?.journalDay} ${d}`,"YYYYMMDD HH:mm").format(),allDay:!1,timeFrom:"journal"}:{start:m(e?.page?.journalDay+"","YYYYMMDD").format(),allDay:!0,timeFrom:"journal"}}return null},je=()=>({tasks:{withTime:[],noTime:[]},milestones:{withTime:[],noTime:[]}}),Tt=async()=>{let e=await logseq.DB.datascriptQuery(`
  [:find (pull
    ?block
    [:block/uuid
      :block/parent
      :db/id
      :block/left
      :block/collapsed?
      :block/format
      :block/_refs
      :block/path-refs
      :block/tags
      :block/content
      :block/marker
      :block/priority
      :block/properties
      :block/pre-block?
      :block/scheduled
      :block/deadline
      :block/repeated?
      :block/created-at
      :block/updated-at
      :block/file
      :block/heading-level
      {:block/page
        [:db/id :block/name :block/original-name :block/journal-day :block/journal?]}
      {:block/refs
        [:db/id :block/name :block/original-name :block/journal-day :block/journal?]}])
    :where
    [?block :block/marker ?marker]
    [(contains? #{"TODO" "DOING" "NOW" "LATER" "WAITING" "DONE" "CANCELED"} ?marker)]]
  `);if(!e||e?.length===0)return null;const o=q();e=e.flat(),o.ignoreTag&&(e=e.filter(l=>!l.refs?.some(u=>u?.["original-name"]===o.ignoreTag)));let a=je(),n=je();const r=new Map,s=e.map(async l=>{l={...l,uuid:l.uuid?.$uuid$,page:{...l.page,originalName:l.page?.["original-name"],journalDay:l.page?.["journal-day"]},refs:l.refs?.map(p=>({...p,journalDay:p?.["journal-day"],originalName:p?.["original-name"]}))};const i=await oe(l,o),u=i.addOns.type==="milestone",d=i.rawTime,c=i.addOns.isJournal;if(u?d?a.milestones.withTime.push(i):a.milestones.noTime.push(i):d?a.tasks.withTime.push(i):a.tasks.noTime.push(i),c)u?d?n.milestones.withTime.push(i):n.milestones.noTime.push(i):d?n.tasks.withTime.push(i):n.tasks.noTime.push(i);else{const p=i.addOns.project,g=r.get(p)||je();u?d?g.milestones.withTime.push(i):g.milestones.noTime.push(i):d?g.tasks.withTime.push(i):g.tasks.noTime.push(i),r.set(p,g)}});return await Promise.all(s),{journalEvents:n,projectEventsMap:r,fullEvents:a}},bo=e=>e.addOns.pomodoros?.reduce((o,a)=>o+a.length,0)||0,fe=Q(je()),Ce=Q(je()),De=Q(new Map),At=Q(e=>{const o=e(fe),a=o.tasks.withTime.map(Ke),n=o.milestones.withTime.map(Ze);return a.concat(n)}),Sn=Q(e=>{const{journal:o}=q(),a=e(At);return{calendarConfig:o,schedules:a.filter(({calendarId:n})=>n==="Journal")}}),Nn=Q(e=>{const{projectList:o=[]}=q(),a=e(At);return o?.map(n=>({calendarConfig:n,schedules:a.filter(({calendarId:r})=>r===n.id)}))}),On=Q(e=>{const o=e(fe),a=m().subtract(14,"day"),n=m();return o.tasks.withTime.filter(r=>m(r.start).isBetween(a,n,"day","(]"))}),Xe=Q(e=>e(fe).tasks.withTime.filter(a=>{if(a.addOns.status==="canceled")return!1;if(a.addOns.isOverdue)return!0;const n=m(a.addOns.start),r=m(a.addOns.end);return m().isBetween(n,r,"day","[]")}).sort((a,n)=>m(a.addOns.start).diff(m(n.addOns.start)))),et=Q(e=>{const{projectList:o=[],journal:a}=q();return([a].concat(o)?.filter(s=>s?.enabled)).map(s=>{const l=s.id,i=s.id==="Journal"?e(Ce):e(De).get(l),u=s.id==="Journal"?a:o.find(g=>g.id===l);if(!i)return{id:l,title:l,amount:{doing:0,todo:0,done:0},style:{bgColor:s.bgColor||"#fff",borderColor:s.borderColor||"#fff",color:s.textColor||"#000"},events:[],milestones:[]};const{doing:d,todo:c,done:p}=ge(i?.tasks?.withTime);return{id:l,title:l,amount:{doing:d?.length,todo:c?.length,done:p?.length},style:{bgColor:u?.bgColor||"#fff",borderColor:u?.borderColor||"#fff",color:u?.textColor||"#000"},events:i.tasks.withTime.map(wo),milestones:i.milestones.withTime.map(wo)}}).filter(function(s){return Boolean(s)})}),ko=36,ue=40,tt=30,Mn={day:108,week:44,month:20},In=[{value:"simple",label:"Simple"},{value:"advanced",label:"Advanced"}],En=[{value:"day",label:"Day"},{value:"week",label:"Week"},{value:"month",label:"Month"}],St=(e,o)=>{const a=[];let n=e;for(;n.isSameOrBefore(o);)a.push(n.clone()),n=n.add(1,"day");return a},vo=e=>e.day()===0||e.day()===6,qn=(e,o="simple")=>{let a=[];return e.forEach((n,r)=>{const s=a[r-1],{levelCount:l=0,events:i=[],milestones:u=[]}=s||{},d=o==="simple"?l:i.length,c=o==="simple"?u.length>0?1:0:u.length,p=r===0?0:s.coordinate.y+(d+c)*ue+ko+tt;a.push({...n,coordinate:{x:0,y:p}})}),a},xo=(e,o,a)=>o.diff(e,"day")*a,ot=(e,o="")=>{document.getElementById(`date${o}${e.format("YYYYMMDD")}`)?.scrollIntoView({block:"nearest",inline:"center",behavior:"smooth"})},Pn=e=>e.map(o=>Co(o)),jn=e=>e.map(o=>Bn(o)),Bn=e=>{const{events:o,rangeStart:a,rangeEnd:n}=Co(e);let r=Do(o,[],m(a),m(n));return{...e,levelCount:r.length,events:r.map((s,l)=>s.map(i=>({...i,level:l}))).flat()}},Co=e=>{const{events:o,milestones:a}=e;o.sort((u,d)=>m(u.start).diff(m(d.start)));let n=new Map;o.forEach(u=>{const{start:d}=u;n.has(d)?n.get(d)?.push(u):n.set(d,[u])}),n.forEach(u=>{u.sort((d,c)=>{const p=m(d.end).diff(m(d.start),"day");return m(c.end).diff(m(c.start),"day")-p})});const r=Array.from(n.values()),s=r[0]?.[0]?.start,l=r[r.length-1]?.[0]?.end,i=r.flat();return{...e,events:i,milestones:a?.sort((u,d)=>m(u.start).diff(m(d.start))),rangeStart:s,rangeEnd:l}};function Ln(e,o){const a=new Map;return St(e,o).forEach(n=>{a.set(n.format("YYYY-MM-DD"),!1)}),a}function Do(e=[],o=[],a,n){const r=Ln(m(a),m(n)),s=[],l=[];return e.forEach(i=>{const{start:u,end:d}=i,c=m(u),p=m(d),g=St(c,p).map(b=>b.format("YYYY-MM-DD"));r.get(c.format("YYYY-MM-DD"))===!1?(g.forEach(b=>{r.set(b,!0)}),s.push(i)):l.push(i)}),o.push(s),l?.length===0?o:Do(l,o,a,n)}const _n=e=>{const o=e.map(r=>{const{events:s,milestones:l=[]}=r;return[...s,...l]}).flat();let a=m(),n=m();return o.forEach(r=>{const{start:s,end:l}=r;m(s).isBefore(a)&&(a=m(s)),m(l).isAfter(n)&&(n=m(l))}),{start:a,end:n}},Rn=({data:e,mode:o="simple",view:a="day",weekStartDay:n=0,uniqueId:r=""},s)=>{const l=m(),{start:i,end:u}=_n(e),d=i.subtract(1,"day"),c=u.add(9,"day"),p=Mn[a],g=St(d,c),C=qn(e,o).map((k,y)=>{const{events:N,milestones:w=[]}=k,A=o==="simple"?(k.levelCount||0)*ue:N.length*ue,S=o==="simple"?(w.length>0?1:0)*ue:w.length*ue,v=A+S+tt;return{...k,height:v,events:k.events.map((D,j)=>{const P=o==="simple"?D?.level||0:j;return{...D,coordinates:{x:xo(d,m(D.start),p),y:k.coordinate.y+P*ue},size:{width:p*(m(D.end).diff(m(D.start),"day")+1)-8,height:ue-4}}}),milestones:k.milestones?.map((D,j)=>{const P=o==="simple"?0:j;return{...D,coordinates:{x:xo(d,m(D.start),p),y:k.coordinate.y+A+P*ue}}})}}),T=C.reduce((k,y)=>k+y.height+ko,0);return x.exports.useEffect(()=>{document.getElementById(`date${r}${m().format("YYYYMMDD")}`)?.scrollIntoView({block:"nearest",inline:"center"})},[]),x.exports.useImperativeHandle(s,()=>({scrollToToday(){ot(m(),r)}})),h("div",{className:"calendar h-fit w-fit",children:[t("div",{className:"w-fit whitespace-nowrap bg-quaternary sticky top-0 z-20 text",children:g.map(k=>{const N=k.format("DD")==="01"||k.isSame(d,"day")||k.isSame(c,"day");return t("div",{className:"inline",children:t("span",{className:"inline-block text-center sticky bg-quaternary overflow-visible box-content",style:{width:`${p}px`,left:0,lineHeight:"25px",paddingRight:"100px",marginRight:"-100px"},children:N?k.format("MMMM YYYY"):""})},"month"+k.valueOf())})}),t("div",{className:"calendar__header w-fit whitespace-nowrap bg-quaternary sticky z-20",style:{top:"25px"},children:g.map(k=>{const y=k.format("DD"),N=vo(k),w=k.isSame(l,"day");let A=!0;return a==="month"&&(A=k.day()===n||w),t("div",{className:`calendar__date inline-flex ${N?"weekend":""} ${w?"today":""}`,id:"date"+r+k.format("YYYYMMDD"),children:t("span",{className:`inline-block text-center ${A?"":"opacity-0"}`,style:{width:"108px"},children:y})},"date"+k.valueOf())})}),t("div",{className:"calendar__content relative",style:{height:T+"px"},children:C.map(k=>h("div",{className:"calendar__group w-fit",children:[t("div",{className:"flex",children:g.map((y,N)=>{const w=vo(y),A=y.isSame(l,"day");return t("div",{className:`calendar__content__back ${w?"weekend":""} ${A?"today":""}`,style:{height:k.height+"px"}})})}),k.events.map(y=>{const{coordinates:N,size:w,detailPopup:A,completed:S}=y;return t(_t,{content:A,trigger:"click",children:t("div",{className:`calendar__event absolute bg-quaternary rounded cursor-pointer single_ellipsis shadow ${S?"completed":""}`,style:{left:N.x,top:N.y+tt,width:w.width+"px",height:w.height+"px",zIndex:1},title:y.title,children:y.title},y.id)})}),k.milestones?.map(y=>{const{coordinates:N,detailPopup:w,completed:A}=y;return h(re,{children:[t("div",{className:"calendar__milestone__line absolute",style:{left:N.x+p/2,top:k.coordinate.y,height:k.height+16}},"milestone-line"+y.id),t(_t,{content:w,trigger:"click",children:h("div",{className:"calendar__milestone__text absolute flex items-center cursor-pointer",style:{left:N.x+2+p/2,top:N.y+tt},title:y.title,children:[A&&t("svg",{"data-v-651e2bfe":"",viewBox:"0 0 16 16",fill:"white",className:"milestone__mark",children:t("path",{"data-v-651e2bfe":"",d:"M5.536 11.175L2 7.639l1.497-1.497L7 9.642l6-6.28 1.497 1.497-7.464 7.814-1.497-1.497z"})}),t("span",{className:"single_ellipsis",style:{maxWidth:p-20},children:y.title})]},"milestone-text"+y.id)})]})})]},k.id))})]})};var Yn=x.exports.forwardRef(Rn);const Hn=({groupName:e,events:o,milestones:a=[],mode:n,levelCount:r=0,uniqueId:s=""})=>h("div",{className:"group rounded-sm",children:[t("div",{className:"group__title font-medium sticky bg-quaternary title-text single_ellipsis",title:e,children:e}),h("div",{className:"group__content",children:[n==="simple"?new Array(r).fill(0).map((l,i)=>t("div",{className:"group__event cursor-pointer"})):o.map(l=>t("div",{className:"group__event cursor-pointer single_ellipsis",onClick:()=>ot(m(l.start),s),children:l?.title})),n==="simple"?a?.length>0?t("div",{className:"group__event cursor-pointer flex justify-between items-center"}):null:a?.map((l,i)=>t("div",{className:"group__event cursor-pointer single_ellipsis",onClick:()=>ot(m(l.start),s),children:l?.title}))]})]});const at=({weekStartDay:e,data:o,showSidebar:a=!0,showOptions:n=!0,defaultView:r="day",defaultMode:s="simple",showModeSelector:l=!1,theme:i="light",uniqueId:u="",...d})=>{const c=x.exports.useRef(),[p,g]=x.exports.useState(r),[b,C]=x.exports.useState(s),T=b==="simple"?jn(o):Pn(o);return h("div",{className:O(`w-full h-full relative gantt text view-${p}`,{dark:i==="dark"},{light:i!=="dark"}),...d,children:[a&&t("div",{className:"calendar__placeholder absolute bg-quaternary"}),n&&h("div",{className:"operation absolute right-0 top-0 z-30 bg-quaternary",children:[t(U,{size:"small",shape:"round",onClick:()=>ot(m(),u),children:"Today"}),t($,{size:"small",options:En,defaultValue:p,onChange:k=>g(k),style:{minWidth:"80px"},className:"ml-2 select-style"}),l&&t($,{size:"small",options:In,defaultValue:"simple",onChange:k=>C(k),style:{minWidth:"110px"},className:"ml-2 select-style"})]}),h("div",{className:"flex h-full overflow-auto relative scroll-style",children:[a&&t("div",{className:"side-bar bg-quaternary sticky left-0 z-10 h-fit",children:T.map((k,y)=>t(Hn,{mode:b,groupName:k.title,events:k?.events,milestones:k?.milestones,levelCount:k.levelCount,uniqueId:u},k.id))}),t(Yn,{data:T,ref:c,mode:b,view:p,uniqueId:u})]})]})},$n="_content_16805_1",Fn="_stats_16805_4",Un="_statsRight_16805_7",Wn="_amount_16805_10",Gn="_project_16805_15",zn="_projectContent_16805_18",Qn="_milestone_16805_22",Jn="_timeline_16805_26",Vn="_showTimeline_16805_26",Kn="_option_16805_39",Zn="_rightSide_16805_43",Xn="_taskLine_16805_49",er="_module_16805_52",tr="_task_16805_49",or="_taskDone_16805_66",ar="_taskActive_16805_69",nr="_time_16805_26",rr="_overdue_16805_92",sr="_sub_16805_95";var L={content:$n,stats:Fn,statsRight:Un,amount:Wn,project:Gn,projectContent:zn,milestone:Qn,timeline:Jn,showTimeline:Vn,option:Kn,rightSide:Zn,taskLine:Xn,module:er,task:tr,taskDone:or,taskActive:ar,time:nr,overdue:rr,sub:sr};function lr(e){const{milestones:o=[]}=e;if(o?.length===0)return null;const a=o.filter(n=>m(n.start).isSameOrAfter(m(),"day"));return a.length===0?null:a.sort((n,r)=>m(n.start).diff(m(r.start)))?.[0]}const ir=({data:e})=>{let[o]=E(Ce);if(e.title!=="Journal"){const[v]=E(De);o=v.get(e.title)}const[a,n]=x.exports.useState(!1),r=ce(),s=Bt(),l=lr(e),i=o?.tasks?.withTime.concat(o?.tasks?.noTime),{todo:u,doing:d,done:c,waiting:p,canceled:g}=ge(i),b=d.length,C=u.length,T=c.length,k=p.length,y=g.length,N=b+C+T+k,w=N===0?0:T/N,A=async v=>{const{id:D,originalName:j}=v?.raw?.page||{};let P=j;P||(P=(await de({id:D}))?.originalName),logseq.Editor.scrollToBlockInPage(P,v?.raw?.uuid),logseq.hideMainUI()},S=async()=>{const v=e.id;s(`/project/${encodeURIComponent(v)}`)};return h("div",{className:O(L.project),children:[h("div",{className:O("flex flex-col flex-1 w-0",L.projectContent,{[L.expand]:a}),children:[h("div",{className:"flex justify-between items-center h-24 p-3",children:[h("div",{className:"h-full flex items-center cursor-pointer",onClick:S,children:[t("div",{className:"w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center text-lg font-medium",style:{backgroundColor:e?.style?.bgColor,color:e?.style?.color},children:Array.from(e.title)?.[0]?.toUpperCase()}),h("div",{className:"ml-3",children:[t("div",{className:"text-lg title-text",children:e.title}),t("div",{className:"mt-1 description-text",children:`doing: ${b} todo: ${C} done: ${T} waiting: ${k} canceled: ${y}`})]})]}),h("div",{className:"h-full flex items-center",children:[t("div",{style:{width:"4.375rem"},children:t(ho,{progress:parseInt(""+w*100),uniqueId:e.id,height:70,type:"normal"})}),l&&h("div",{className:O("flex flex-col items-center justify-center d h-full pl-3 pr-1 ml-3 cursor-pointer",L.milestone),onClick:()=>A(l),children:[h("div",{className:"text-center",children:[t("span",{className:"text-3xl title-text",children:m(l.start).format("DD")}),t("span",{className:"text-xs description-text ml-1",children:m(l.start).format("MMM")})]}),h("span",{className:"text-xs description-text",children:["days left: ",m(l.start).diff(m(),"day"),"d"]}),t("span",{className:"text-xs description-text ellipsis w-full text-center",title:l.title,children:l.title})]})]})]}),t(it,{children:a&&t(dt.div,{className:O(L.timeline,{[L.showTimeline]:a}),initial:{opacity:0,height:0},animate:{opacity:1,height:"auto",marginTop:"0.5rem",padding:"0.75rem"},exit:{opacity:0,height:0,marginTop:0,padding:0},transition:{ease:"easeInOut",duration:.2},children:t(at,{data:[e],weekStartDay:0,showOptions:!1,showSidebar:!1,defaultView:"week",theme:r,uniqueId:e?.id})})})]}),t("div",{className:O(L.option,"text w-10 h-10 rounded-full flex justify-center items-center shadow-sm text-lg ml-3 cursor-pointer"),onClick:()=>n(!a),children:t("div",{className:"flex items-center",children:a?t(ct,{}):t(ut,{})})})]})};function dr(e,o=!1){const a=e?.addOns.start,n=e?.addOns.end,r=m(a),s=m(n),l=r.isSame(s,"day");return o?e.addOns.allDay?l?{start:r.format("MM-DD")}:{start:r.format("MM-DD"),end:s.format("MM-DD")}:l&&r.isSame(m(),"day")?{start:r.format("HH:mm"),end:s.format("HH:mm")}:l?{start:r.format("MM-DD")}:{start:r.format("MM-DD"),end:s.format("MM-DD")}:l?e.addOns.allDay?{start:"all-day"}:{start:r.format("HH:mm"),end:s.format("HH:mm")}:{start:r.format("MM-DD"),end:s.format("MM-DD")}}const Nt=({task:e,showTimeDot:o=!1,type:a="allDay"})=>{const n=m(e.addOns.start),r=m(e.addOns.end),s=a!=="overdue"&&m().isBetween(n,r),l=e?.addOns.status==="done",i=e.addOns.calendarConfig,{start:u,end:d}=dr(e,a==="overdue");return h("div",{className:O(L.task,{[L.taskActive]:s,[L.taskDone]:l},L?.[a],"flex pl-5 pr-4 py-2 items-center justify-between"),children:[o&&t("div",{className:O(L.time),children:t("span",{children:n?.format("HH:mm")})}),t("div",{className:"w-7 h-7 rounded-full flex items-center justify-center",style:{backgroundColor:i?.bgColor,color:i?.textColor},title:i?.id,children:Array.from(i?.id)?.[0]?.toUpperCase()}),h("div",{className:"flex flex-col flex-1 ellipsis mx-4",children:[t("span",{className:"ellipsis text",children:e.addOns.showTitle}),h("div",{className:O(L.sub,"text-xs flex justify-between"),children:[t("span",{className:"description-text",children:d?`${u} - ${d}`:u}),t("span",{className:"ml-2 ellipsis #6b531a",title:i?.id,children:i?.id})]})]}),t("div",{className:"w-5 h-5 cursor-pointer text",onClick:async()=>{const{id:c,originalName:p}=e?.page||{};let g=p;g||(g=(await de({id:c}))?.originalName),logseq.Editor.scrollToBlockInPage(g,e.uuid),logseq.hideMainUI()},children:t(Rt,{})})]})},To=Q([]),nt=Q([]),Ao=Q(e=>e(nt).filter(a=>{const n=m(a.start),r=m(a.end);return m().isBetween(n,r,"day","[]")}).sort((a,n)=>m(a.start).diff(m(n.start))));function cr(e){const o=e?.start,a=e?.end,n=m(o),r=m(a);return n.isSame(r,"day")?e.isAllDay?{start:"all-day"}:{start:n.format("HH:mm"),end:r.format("HH:mm")}:{start:n.format("MM-DD"),end:r.format("MM-DD")}}const So=({subscription:e,showTimeDot:o=!1,type:a="allDay"})=>{const n=m(e.start),r=m(e.end),s=a!=="overdue"&&m().isBetween(n,r),{start:l,end:i}=cr(e);return h("div",{className:O(L.task,{[L.taskActive]:s},L?.[a],"flex pl-5 pr-4 py-2 items-center justify-between"),children:[o&&t("div",{className:O(L.time),children:t("span",{children:n?.format("HH:mm")})}),t("div",{className:"w-7 h-7 rounded-full flex items-center justify-center",style:{backgroundColor:e?.bgColor,color:e?.color},title:e.calendarId,children:Array.from(e.calendarId)?.[0]?.toUpperCase()}),h("div",{className:"flex flex-col flex-1 ellipsis mx-4",children:[t("span",{className:"ellipsis text",children:e.title}),h("div",{className:O(L.sub,"text-xs flex justify-between"),children:[t("span",{className:"description-text",children:i?`${l} - ${i}`:l}),t("span",{className:"ml-2 ellipsis #6b531a",title:e.calendarId,children:e.calendarId})]})]})]})},ur=()=>{const[e]=E(Ao),{allDaySubscriptions:o,timeSubscriptions:a}=so(e),[n]=E(Xe),{overdueTasks:r,allDayTasks:s,timeTasks:l}=ro(n);return h("div",{className:L.taskLine,children:[r.length>0&&h("div",{className:L.module,children:[t("span",{children:"Overdue"}),r.map(i=>t(Nt,{task:i,type:"overdue"},i.id))]}),(s.length>0||o.length>0)&&h("div",{className:L.module,children:[t("span",{children:"All Day"}),o.map(i=>t(So,{subscription:i,type:"allDay"},i.id)),s.map(i=>t(Nt,{task:i,type:"allDay"},i.id))]}),(l.length>0||a.length>0)&&h("div",{className:L.module,children:[t("span",{children:"Time"}),a.map(i=>t(So,{subscription:i,type:"time",showTimeDot:!0},i.id)),l.map(i=>t(Nt,{task:i,type:"time",showTimeDot:!0},i.id))]})]})};function mr(){const[e]=E(On),o=Ka(ge(e)?.done),a=m().subtract(13,"day").startOf("day"),n=[a];for(let r=1;r<14;r++)n.push(a.add(r,"day"));return n.map(r=>{const s=o.get(r.format());return{date:r.format(),value:s?.length||0}})}const pr=()=>{const e=mr(),[o]=E(et),a=o||[],[n]=E(Xe),r=ge(n),s=r?.todo?.length+r?.doing?.length,l=r?.done?.length,i=s+l,u=i===0?0:parseInt(l/i*100+""),d=async()=>{const{preferredDateFormat:c}=await logseq.App.getUserConfigs(),p=X(te(m().format("YYYY-MM-DD"),Ee,new Date),c);logseq.App.pushState("page",{name:p}),logseq.hideMainUI()};return h("div",{className:"page-container flex",children:[h("div",{className:O(L.content,"flex flex-col flex-1 p-8"),children:[t("h1",{className:"title-text",children:"Dashboard"}),h("div",{className:"flex-1 overflow-auto",children:[h("div",{className:O(L.stats,"flex"),children:[t("div",{className:"flex-1",children:t(Dn,{data:e})}),h("div",{style:{width:"160px"},className:O("h-full rounded-xl shadow-sm cursor-pointer",L.statsRight),onClick:d,children:[t(ho,{progress:u}),h("div",{className:"flex justify-between px-6",children:[h("div",{className:O("flex flex-col rounded-lg text-center py-1 shadow-sm",L.amount),children:[t("span",{className:"text-3xl title-text",children:s}),t("span",{className:"text",children:"Todo"})]}),h("div",{className:O("flex flex-col rounded-lg text-center py-1 shadow-sm",L.amount),children:[t("span",{className:"text-3xl title-text",children:l}),t("span",{className:"text",children:"Done"})]})]})]})]}),t("div",{className:"mt-8",children:a.map(c=>t(ir,{data:c},c.id))})]})]}),t("div",{className:L.rightSide,children:t(ur,{})})]})},No=({visible:e,initialValues:o,onCancel:a,onSave:n,type:r="create",calendar:s,showKeepRef:l})=>{const[i,u]=x.exports.useState(!o?.isAllDay),{defaultDuration:d,projectList:c=[],journal:p}=q(),g=o?.calendarId==="Journal";let C=!c.some(({id:w})=>w===o?.calendarId)&&!g&&r==="update"?[p,{id:o?.calendarId,...Ve},...c]:[p,...c];const[T]=f.useForm();return t(se,{title:"Modify Schedule",visible:e,onOk:()=>{T.validateFields().then(async w=>{const{title:A,start:S,end:v,isAllDay:D,calendarId:j}=w,P=m(S).format("HH:mm"),I=m(v).format("HH:mm"),B=q();let R=C.find(({id:_})=>_===j.value)?.id==="Journal"?"journal":"project";const Z=R==="journal";if(m(S).isAfter(m(v),D?"day":void 0))return logseq.App.showMsg("Start time cannot be later than end time","error");if(Z&&!m(S).isSame(m(v),"day"))return logseq.App.showMsg("Journal schedule cannot span multiple days","error");const Te=o?.raw?.format==="markdown"?Ue:We;let Y=r==="update"&&o?.raw?.addOns.pomodoros?.length?`${A} ${o?.raw?.content.match(Te)?.[0]}`:A;R==="journal"?(r==="create"&&(Y=D?`TODO ${Y}`:`TODO ${P}-${I} ${Y}`),r==="update"&&(Y=D?Je(o?.raw,Y):Je(o?.raw,Va(Y,P,I)))):R==="project"&&(r==="create"?Y="TODO "+bt(Y,{start:S,end:v,allDay:D}):r==="update"&&(Y=Je(o?.raw,bt(Y,{start:S,end:v,allDay:D}))));const G={},{preferredDateFormat:ye}=await logseq.App.getUserConfigs();let Ae=o?.calendarId;if(Z){const _=o?.start;_&&(Ae=X(_?.valueOf(),ye))}let ee=j.value;if(Z){const _=X(S.valueOf(),ye),H=await logseq.Editor.createPage(_,{},{journal:!0});H&&(ee=H.originalName)}if(r==="create"){const _=logseq.settings?.logKey;let H;if(Z?H=_?.enabled?await co(ee,`[[${_?.id}]]`,Y,G):await logseq.Editor.insertBlock(ee,Y,{isPageBlock:!0,sibling:!0,properties:G}):R==="project"&&(H=await co(ee,Jt,Y)),!H)return logseq.App.showMsg("Create block failed","error");const me=await logseq.Editor.getBlock(H.uuid),pe=await oe(me,B),we=pe?.addOns?.type==="milestone"?Ze(pe):Ke(pe);s?.createSchedules([we])}else if(ee!==Ae){let _;const H=logseq.settings?.logKey;if(Z?_=H?.enabled?await kt(o?.id,ee,`[[${H?.id}]]`):await io(o?.id,ee):R==="project"&&(_=await kt(o?.id,ee,Jt)),await lo(_.uuid,Y,G),Object.keys(G).length===0&&(await logseq.Editor.removeBlockProperty(_.uuid,"start"),await logseq.Editor.removeBlockProperty(_.uuid,"end")),_&&o?.calendarId){const me=await logseq.Editor.getBlock(_.uuid);s?.deleteSchedule(o?.id,o.calendarId);const pe=await oe(me,B),we=o?.raw?.addOns.type==="milestone"?Ze(pe):Ke(pe);s?.createSchedules([we])}}else{await lo(o?.id,Y);const _=await logseq.Editor.getBlock(o?.id),H=await oe(_,B),me=o?.raw?.addOns.type==="task"?Ke(H):Ze(H);s?.updateSchedule(o?.id,o?.calendarId,me)}n?.()})},onCancel:()=>{a?.()},children:h(f,{form:T,onValuesChange:(w,A)=>{w.isAllDay!==void 0&&u(!w.isAllDay),w.start!==void 0&&T.setFieldsValue({end:w.start?.clone().add(d.value,d.unit)})},initialValues:{isAllDay:!0,...o,calendarId:o?.calendarId?{value:o?.calendarId}:void 0},children:[t(f.Item,{name:"calendarId",label:"Project",rules:[{required:!0}],children:t($,{labelInValue:!0,children:C.map(w=>h($.Option,{value:w?.id,children:[t("span",{style:{width:"12px",height:"12px",display:"inline-block",backgroundColor:w?.bgColor,verticalAlign:"middle",marginRight:"5px",borderRadius:"4px"}}),w?.id]},w?.id))})}),t(f.Item,{name:"title",label:"Schedule Title",rules:[{required:!0}],children:t(J,{})}),t(f.Item,{name:"start",label:"Start",rules:[{required:!0}],children:t(_e,{showTime:i?{format:"HH:mm"}:!1,format:i?"YYYY-MM-DD HH:mm":"YYYY-MM-DD"})}),t(f.Item,{name:"end",label:"End",rules:[{required:!0}],children:t(_e,{showTime:i?{format:"HH:mm"}:!1,format:i?"YYYY-MM-DD HH:mm":"YYYY-MM-DD"})}),t(f.Item,{name:"isAllDay",label:"All Day",rules:[{required:!0}],children:h(W.Group,{children:[t(W,{value:!0,children:"Yes"}),t(W,{value:!1,children:"No"})]})})]})})},Ot=({checked:e,color:o,indeterminate:a,onChange:n,children:r,...s})=>h("div",{onClick:()=>n?.(!e),...s,children:[t("span",{className:`check-box mr-2 ${e?"checked":""}`,style:{backgroundColor:o}}),r]}),hr=({onShowCalendarChange:e,calendarList:o=[],subscriptionList:a=[]})=>{const[n,r]=x.exports.useState(["calendar","subscription"]),[s,l]=x.exports.useState(o.map(c=>c.id)?.concat(a?.map(c=>c.id))),i=(c,p)=>{let g=s.filter(b=>b!==c);p&&(g=s.concat(c)),l(g),e?.(g)},u=c=>{let p=[];c&&(p=o.map(g=>g.id)?.concat(a?.map(g=>g.id))),l(p),e?.(p)},d=c=>t("span",{className:"text text-xs",children:c});return h("div",{className:"sidebar pt-2 bg-quaternary",children:[h(le,{ghost:!0,expandIconPosition:"right",activeKey:n,expandIcon:({isActive:c})=>t("span",{className:"opacity-50",children:t(Ho,{rotate:c?0:-90})}),onChange:c=>r(typeof c=="string"?[c]:c),children:[t(le.Panel,{header:d("Project"),children:o.map(c=>t(Ot,{className:"mb-1 cursor-pointer flex items-center",color:c.bgColor,checked:s?.includes(c.id),onChange:p=>i(c.id,p),children:t(Se,{title:c.id,placement:"right",children:t("span",{className:"singlge-line-ellipsis flex-1",children:c.id})})},c.id))},"calendar"),a?.length>0&&t(le.Panel,{header:d("Subscription"),className:"mt-3",children:a.map(c=>t(Ot,{className:"mb-1 cursor-pointer flex items-center",color:c.bgColor,checked:s?.includes(c.id),onChange:p=>i(c.id,p),children:t(Se,{title:c.id,placement:"right",children:t("span",{className:"singlge-line-ellipsis flex-1",children:c.id})})},c.id))},"subscription")]}),t(Yt,{className:"my-2"}),t("div",{style:{padding:"0 10px"},children:t(Ot,{color:"#047857",checked:s?.length===o.length+a?.length,onChange:c=>u(c),children:t("span",{className:"cursor-pointer",children:"Check All"})})})]})},Mt=({schedules:e,isProjectCalendar:o=!0,isDailyLogCalendar:a=!1})=>{const{subscriptionList:n,logKey:r,projectList:s=[],journal:l}=q(),[i,u]=x.exports.useState(),[d,c]=x.exports.useState(!0),[p,g]=x.exports.useState(()=>a?"week":logseq.settings?.defaultView||"month"),b=[l,...s],C=n?n?.filter(I=>I?.enabled):[],[T,k]=x.exports.useState({visible:!1,type:"create"}),y=x.exports.useRef(),N=()=>{if(y.current){const I=y.current.getDateRangeStart().getTime(),B=y.current.getDateRangeEnd().getTime();zo(I,B)?u(X(I,Ee)):u(X(I,Ee)+" ~ "+X(B,Ee))}},w=I=>{g(I),I==="2week"?(y.current?.changeView("month"),y.current?.setOptions({month:{visibleWeeksCount:2}})):I==="month"?(y.current?.changeView("month"),y.current?.setOptions({month:{visibleWeeksCount:void 0}})):y.current?.changeView(I),N()},A=I=>{(b.concat(C)?.map(M=>M.id)).forEach(M=>{I.includes(M)?y.current?.toggleSchedules(M,!1):y.current?.toggleSchedules(M,!0)})},S=()=>c(I=>!I),v=()=>{y.current?.today(),N()},D=()=>{y.current?.prev(),N()},j=()=>{y.current?.next(),N()},P=async()=>{if(p==="day"&&i){const{preferredDateFormat:I}=await logseq.App.getUserConfigs(),B=X(te(i,Ee,new Date),I);logseq.App.pushState("page",{name:B}),logseq.hideMainUI()}};return x.exports.useEffect(()=>{y.current&&(y.current.clear(),y.current.createSchedules(e))},[e,y.current]),x.exports.useEffect(()=>{window.requestAnimationFrame(async()=>{let I=await nn();a&&(I=rn(I)),y.current=new $o("#calendar",{...I}),N(),y.current.on("clickDayname",function(B){const M=y.current;M?.getViewName()==="week"&&(M.setDate(new Date(B.date)),M.changeView("day",!0),N(),g("day"))}),y.current.on("clickSchedule",function(B){document.querySelector("#faiz-nav-detail")?.addEventListener("click",async M=>{const R=B.schedule.raw||{},{id:Z,originalName:Te}=R?.page||{};let Y=Te;Y||(Y=(await logseq.Editor.getPage(Z))?.originalName);const{uuid:G}=await logseq.Editor.getBlock(R.id)||{uuid:""};logseq.Editor.scrollToBlockInPage(Y,G),logseq.hideMainUI()},{once:!0})}),y.current.on("beforeCreateSchedule",function(B){k({visible:!0,type:"create",values:{start:m(B.start),end:m(B.end),isAllDay:B.triggerEventName==="dblclick"}})}),y.current.on("beforeUpdateSchedule",async function(B){const{schedule:M,changes:R,triggerEventName:Z,start:Te,end:Y}=B;if(Z==="click")k({visible:!0,type:"update",values:{id:M.id,start:m(M.start),end:m(M.end),isAllDay:M?.raw?.category!=="time",calendarId:M.calendarId,title:M.title,raw:M.raw}});else if(R){if(M.calendarId==="journal"&&!m(Te).isSame(m(Y),"day"))return logseq.App.showMsg("Journal schedule cannot span multiple days","error");const G=M.raw,ye=M.calendarId==="Journal"?"journal":"project",Ae=R?.start?R.start:G.rawTime?.start,ee=R?.end?R.end:G.rawTime?.end;if(ye==="journal"&&R.start){y.current?.updateSchedule(M.id,M.calendarId,R);const{preferredDateFormat:_}=await logseq.App.getUserConfigs();let H=G.content;if(G.rawTime?.timeFrom==="customLink"&&(H=no(H.trim())),G.rawTime?.timeFrom==="refs"){const _o=X(m(G.rawTime.start).valueOf(),_);H=H.replace(`[[${_o}]]`,"")?.trim()}const me=X(Ae.valueOf(),_),we=(await logseq.Editor.createPage(me,{},{journal:!0})).originalName;await logseq.Editor.updateBlock(M.id,H),r?.enabled?await kt(M?.id,we,`[[${r?.id}]]`):await io(M?.id,we)}else if(ye==="project"){y.current?.updateSchedule(M.id,M.calendarId,R);const _=Je(G,bt(G.addOns.contentWithoutTime,{start:m(Ae),end:m(ee),allDay:G.addOns.allDay}))?.split(`
`)?.[0];await logseq.Editor.updateBlock(M.id,_)}}}),y.current.on("beforeDeleteSchedule",function(B){const{schedule:M}=B;se.confirm({title:"Are you sure delete this schedule?",content:t("div",{className:"whitespace-pre-line",children:M.raw?.content}),onOk:async()=>{const R=await logseq.Editor.getBlock(M.raw?.id);if(!R)return logseq.App.showMsg("Block not found","error");logseq.Editor.removeBlock(R?.uuid),y.current?.deleteSchedule(M.id,M.calendarId)}})})})},[]),h("div",{className:"flex flex-col w-full h-full",children:[h("div",{className:"mb-2 flex items-center justify-between",children:[h("div",{className:"flex items-center",children:[!o&&!a&&t(U,{className:"mr-2",onClick:S,icon:d?t(Fo,{}):t(Uo,{})}),t(U,{className:"ml-2",shape:"circle",icon:t(Wo,{}),onClick:D}),t(U,{className:"ml-1",shape:"circle",icon:t(Go,{}),onClick:j}),t(U,{className:"ml-2",shape:"round",onClick:v,children:"Today"}),t(Se,{title:p==="day"?"Navigate to this journal note":"",children:t("span",{className:`ml-4 text-xl h-full items-center inline-block title-text ${p==="day"?"cursor-pointer":"cursor-auto"}`,style:{height:"34px",lineHeight:"34px"},onClick:P,children:i})})]}),t("div",{children:t(W.Group,{options:zt,value:p,defaultValue:logseq.settings?.defaultView||"month",onChange:I=>w(I.target.value),optionType:"button",buttonStyle:"solid"})})]}),h("div",{className:"flex flex-1",children:[t("div",{className:`transition-all overflow-hidden bg-quaternary title-text mr-2 ${d?"w-0 mr-0":"w-40"}`,children:t(hr,{onShowCalendarChange:A,calendarList:b,subscriptionList:C})}),t("div",{className:"flex-1 w-0",children:t("div",{id:"calendar",className:"h-full title-text"})})]}),T.visible?t(No,{visible:T.visible,type:T.type,initialValues:T.values,calendar:y.current,onCancel:()=>{k({visible:!1}),y.current?.render()},onSave:()=>{k({visible:!1})}}):null]})},gr="_container_1ypzn_1",fr="_sideBar_1ypzn_5";var yr={container:gr,sideBar:fr};const wr=()=>{const[e]=E(At),[o]=E(nt),[a,n]=x.exports.useState([]);return x.exports.useEffect(()=>{za().then(r=>{n(r)})},[]),t("div",{className:"page-container flex",children:h("div",{className:O(yr.content,"flex flex-1 flex-col overflow-hidden p-8"),style:{maxWidth:"1800px"},children:[t("h1",{className:"title-text",children:"Calendar"}),t("div",{className:"bg-quaternary flex flex-col flex-1 rounded-2xl box-border p-6",children:t(Mt,{schedules:[...o,...e,...a],isProjectCalendar:!1})})]})})},br="_contentWrapper_42y1q_1",kr="_timelineWrapper_42y1q_7";var It={contentWrapper:br,timelineWrapper:kr};const vr=({project:e})=>{const[o,a]=x.exports.useState(!0),n=ce();return h("div",{className:O(It.timelineWrapper,{[It.expand]:o},"rounded-2xl mb-9 h-auto p-6 shadow"),children:[h("h3",{className:"title-text flex items-center cursor-pointer",onClick:()=>a(r=>!r),children:[e.title,o?t(ct,{className:"ml-2"}):t(ut,{className:"ml-2"})]}),t(it,{children:o&&t(dt.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"60vh"},exit:{opacity:0,height:0},transition:{ease:"easeInOut",duration:.2},children:t(at,{data:[e],weekStartDay:logseq.settings?.weekStartDay||0,theme:n,defaultMode:"advanced",uniqueId:ft()})})})]})},xr=()=>{const[e]=E(et),o=e||[];return h("div",{className:"page-container p-8 flex flex-col",children:[t("h1",{className:"title-text",children:"Gantt"}),t("div",{className:O(It.contentWrapper),children:o.map(a=>t(vr,{project:a}))})]})},Cr="_contentWrapper_42y1q_1",Dr="_timelineWrapper_42y1q_7";var Et={contentWrapper:Cr,timelineWrapper:Dr};const Tr=({project:e})=>{const[o,a]=x.exports.useState(!0),n=ce();return h("div",{className:O(Et.timelineWrapper,{[Et.expand]:o},"rounded-2xl mb-9 h-auto p-6 shadow"),children:[h("h3",{className:"title-text flex items-center cursor-pointer",onClick:()=>a(r=>!r),children:[e.title,o?t(ct,{className:"ml-2"}):t(ut,{className:"ml-2"})]}),t(it,{children:o&&t(dt.div,{className:"overflow-hidden",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{ease:"easeInOut",duration:.2},children:t(at,{data:[e],weekStartDay:logseq.settings?.weekStartDay||0,showSidebar:!1,theme:n,uniqueId:ft()})})})]})},Ar=()=>{const[e]=E(et),o=e||[];return h("div",{className:"page-container p-8 flex flex-col",children:[t("h1",{className:"title-text",children:"Timeline"}),t("div",{className:O(Et.contentWrapper),children:o.map(a=>t(Tr,{project:a}))})]})},z=({value:e,onChange:o,text:a})=>{const[n,r]=x.exports.useState(!1);return h("div",{children:[t("span",{style:{backgroundColor:e},className:"px-2 py-1 rounded cursor-pointer shadow-md",onClick:()=>r(!0),children:a}),n&&h(re,{children:[t("div",{className:"bg-transparent fixed top-0 left-0 w-screen h-screen",onClick:()=>r(!1)}),t("div",{className:"fixed z-10 mt-2",children:t(Qo,{color:e,onChange:l=>{o?.(l.hex)}})})]})]})},Sr=({visible:e,calendarId:o,initialValues:a,onCancel:n,onOk:r,...s})=>{const[l]=f.useForm(),i=()=>{const d=l.getFieldsValue(!0);r?.(d?.query)},u=async d=>{const c=l.getFieldsValue(!0)?.query[d];if(c){console.log(""),ke(`[faiz:] === start exec your query:
`,"blue"),console.log(c?.script);try{let p;c?.queryType==="simple"?p=await logseq.DB.q(c?.script):p=await logseq.DB.datascriptQuery(c.script),ke(`[faiz:] === exec your query success:
`,"green"),console.log(p)}catch(p){ke(`[faiz:] === exec your query failed:
`,"red"),console.error(p)}console.log("")}};return t(se,{...s,width:980,title:"Calendar Queries (saved searches)",visible:e,onCancel:n,onOk:i,children:t("div",{className:"overflow-y-auto overflow-x-hidden",style:{maxHeight:"500px"},children:t(f,{initialValues:{query:a},form:l,size:"small",children:t(f.List,{name:"query",children:(d,{add:c,remove:p})=>h(re,{children:[d.map((g,b)=>h("div",{className:"rounded border-dashed border-gray-200 px-4 pt-4 mb-3 relative",children:[t(f.Item,{label:`Query ${b+1}`,children:h(Ht,{gutter:16,children:[t(mt,{span:12,children:t(f.Item,{label:"script",name:[g.name,"script"],labelCol:{span:4},children:t(J.TextArea,{rows:10})})}),h(mt,{span:12,children:[t(f.Item,{label:"Query Type",name:[g.name,"queryType"],labelCol:{span:7},children:h(W.Group,{children:[t(W,{value:"simple",children:"Simple Query"}),t(W,{value:"advanced",children:"Advanced Query"})]})}),t(f.Item,{label:"Schedule Start",name:[g.name,"scheduleStart"],labelCol:{span:7},children:t(J,{})}),t(f.Item,{label:"Schedule End",name:[g.name,"scheduleEnd"],labelCol:{span:7},children:t(J,{})}),t(f.Item,{label:"Date Formatter",name:[g.name,"dateFormatter"],labelCol:{span:7},children:t(J,{})}),t(f.Item,{label:"Is Milestone",name:[g.name,"isMilestone"],labelCol:{span:7},children:h(W.Group,{children:[t(W,{value:!0,children:"Yes"}),t(W,{value:!1,children:"No"})]})})]})]})}),h("div",{className:"absolute bottom-4 right-4",children:[t(Se,{title:"Execute this query in DevTools",children:t(Jo,{onClick:()=>u(b)})}),b!==0&&t(Re,{className:"ml-2",onClick:()=>p(g.name)})]})]},b)),t(f.Item,{children:t(U,{type:"dashed",size:"small",onClick:()=>c(),block:!0,icon:t(Ne,{}),children:"Add Schedule Query"})})]})})})})})},Oo=({value:e,onChange:o,calendarId:a})=>{const[n,r]=x.exports.useState(!1);return h("div",{children:[t(Se,{title:"Edit Calendar Queries",children:t(U,{type:"link",icon:t(Vo,{}),onClick:()=>r(!0)})}),t(Sr,{visible:n,calendarId:a,initialValues:e,onCancel:()=>r(!1),onOk:s=>{o?.(s),r(!1)}})]})},Nr=({visible:e,onCancel:o,onSave:a})=>{const[n]=f.useForm(),r=async s=>await de({originalName:s})?(logseq.App.showMsg(`The page with the same name already exists
Please add properties to the page manually
agenda:: true`,"error"),{success:!0}):(await logseq.Editor.createPage(s,{agenda:!0}),{success:!0});return t(se,{title:"Create Calendar",visible:e,onOk:()=>{n.validateFields().then(async s=>{const l=s.calendarId.trim();if(s.agenda){const{success:i}=await r(l);if(!i)return}a({name:l,agenda:Boolean(s.agenda)})})},onCancel:o,children:h(f,{form:n,children:[t(f.Item,{name:"calendarId",label:"Calendar ID",rules:[{required:!0}],children:t(J,{})}),t(f.Item,{name:"agenda",label:"Control By Agenda",tooltip:"Checking means that the plugin may modify this document",extra:"Not recommended, please use project instead",children:h(W.Group,{children:[t(W,{value:!0,children:"Yes"}),t(W,{value:!1,children:"No"})]})})]})})},Or=Q(q()),Mo=async(e,o)=>{if(!Array.isArray(e))return[];const a=e?.filter(i=>i?.enabled);if(!a?.length)return[];const r=(await Promise.allSettled(a.map(i=>Ko.get(i.url,{headers:{accept:"text/calendar"}})))).map(async(i,u)=>{if(i.status==="rejected")return logseq.App.showMsg(`Get Calendar ${a[u].id} data error
${i.reason}`,"error"),[];try{const d=Zo.parse(i.value.data),{events:c}=Mr(d),p=c.map(async g=>{const{dtstart:b,dtend:C,summary:T,description:k}=g,y=b.type==="date-time";return await wt({blockData:{id:new Date().valueOf(),content:`${T?.value||"no summary"}
${k?.value||""}`,subscription:!0},category:y?"time":"allday",start:b.value,end:C?y?C?.value:m(C.value).subtract(1,"day").endOf("day").format():void 0,calendarConfig:a[u],defaultDuration:o,isAllDay:!y})});return Promise.all(p)}catch(d){return logseq.App.showMsg(`Parse Calendar ${a[u].id} data error
${d}`,"error"),console.error("[faiz:] === Parse Calendar error",d),[]}});return(await Promise.allSettled(r)).filter(i=>i?.status==="fulfilled").map(i=>i?.value)?.flat()},Mr=e=>{function o(l){return l.reduce((i,u)=>({...i,[u[0]]:{type:u[2],value:u[3]}}),{})}const[a,n,r]=e,s=r.filter(l=>l[0]==="vevent").map(l=>{const[i,u]=l;return o(u)});return{type:a,info:o(n),events:s}},Ir="_title_8pzto_1",Er="_content_8pzto_4",qr="_formBlock_8pzto_8",Pr="_show_8pzto_14",jr="_tabs_8pzto_19",Br="_tab_8pzto_19",Lr="_active_8pzto_27";var F={title:Ir,content:Er,formBlock:qr,show:Pr,tabs:jr,tab:Br,active:Lr};const _r=({value:e,tabs:o,onChange:a})=>{const n=e;return t("div",{className:F.tabs,children:o.map(({value:r,label:s})=>t("div",{className:O(F.tab,{[F.active]:n===r}),onClick:()=>a?.(r),children:s},r))})},rt={4:"A",3:"B",2:"C",1:void 0};let V=null;const qt=e=>{if(V&&!e)return V;if(e)return V=new $t.TodoistApi(e);const{todoist:o}=q();if(o?.token)return V=new $t.TodoistApi(o.token)},Rr=async()=>{if(ke(`
=== Start synchronizing tasks from todoist ... ===
`,"#d27e24"),!V)return logseq.App.showMsg("Please check your todoist configuration","error");const e=q(),{preferredDateFormat:o}=await logseq.App.getUserConfigs(),{todoist:a}=e;let n=[];a?.sync===1&&a.project?n=await V.getTasks({projectId:a.project}):n=await V.getTasks();const r=await Wr(),s=await Promise.all(r?.map(p=>oe(p,e))||[]);console.info("[faiz: pull totoist] === todoist active tasks:",n),console.info("[faiz: pull totoist] === exists logseq events:",s);let l=[],i=[];n.forEach(p=>{const g=s.find(b=>b.properties?.todoistId===p.id);if(!g)return i.push(p);if(Gr(g,p))return l.push({...g,todoistTask:p})});const u=s.filter(p=>p.addOns.status!=="done").filter(p=>!n.find(g=>g.id===p.properties?.todoistId)).map(async p=>({...p,todoistTask:await V?.getTask(p.properties?.todoistId)})),c=(await Promise.allSettled(u)).map(p=>p.status==="rejected"?null:p.value).filter(Boolean);l=[...l,...c],console.log("[faiz: pull todoist] === needUpdateEvents",l),console.log("[faiz: pull todoist] === needCreateTasks",i),console.log("[faiz: pull todoist] === eventsNotInActiveTasks",c),i.forEach(p=>zr(p,o)),l.forEach(p=>Io(p,p.todoistTask)),logseq.App.showMsg(`Get todoist data successfully:
${i.length} new tasks created
${l.length} tasks updated`),ke(`
=== Synchronizing tasks from todoist success ===
`,"green")},Yr=(e,o)=>V?.updateTask(e,o),Hr=e=>V?.getTask(e),$r=e=>V?.closeTask(e),Fr=e=>V?.reopenTask(e),Ur=e=>V?.addTask(e),Wr=async()=>{const e="(and (task todo doing done waiting canceled later now) (property todoist-id))";return logseq.DB.q(e)},Gr=(e,o)=>{const a=e.addOns.status==="done",n=e.rawTime?m(e.rawTime?.start).valueOf():void 0,r=e.addOns.contentWithoutTime?.split(`
`)[0],s=e.priority,{completed:l,due:i,content:u,priority:d}=o;let c=i?i?.datetime?m(i?.datetime).valueOf():m(i.date).valueOf():void 0;return a!==l||r!==u||n!==c||s!==rt[d]},zr=async(e,o)=>{const a=e.due?.datetime||e.due?.date,n=X(m().valueOf(),o),r=await logseq.Editor.createPage(n,{},{journal:!0});let s=e.content;const l=rt[e.priority];if(l&&(s=`[#${l}] ${s}`),s=`TODO ${s}`,a){const i=e.due?.datetime?"YYYY-MM-DD ddd HH:mm":"YYYY-MM-DD ddd";s+=`
SCHEDULED: <${m(a).format(i)}>`}return logseq.Editor.insertBlock(r.originalName,s,{isPageBlock:!0,sibling:!0,properties:{"todoist-id":e.id}})},Io=async(e,o)=>{if(!o)return;let a=o.content;const n=rt[o.priority];n&&(a=`[#${n}] ${a}`),a=`${o.completed?"DONE":"TODO"} ${a}`;const r=o.due?.datetime||o.due?.date;if(r){const s=o.due?.datetime?"YYYY-MM-DD ddd HH:mm":"YYYY-MM-DD ddd";a+=`
SCHEDULED: <${m(r).format(s)}>`}return await logseq.Editor.updateBlock(e.uuid,a),logseq.Editor.upsertBlockProperty(e.uuid,"todoist-id",o.id)},Eo=[{value:"basis",label:"Basis"},{value:"projects",label:"Project"},{value:"customCalendar",label:"Custom Calendar"},{value:"subscription",label:"Subscription"},{value:"calendarView",label:"Calendar View"},{value:"pomodoro",label:"Pomodoro"},{value:"todoist",label:"Todoist"}],Qr=({...e})=>{const[o]=Xo.useForm(),[a,n]=x.exports.useState(Eo[0].value),[r,s]=x.exports.useState([]),[l,i]=x.exports.useState([]),[u,d]=x.exports.useState([]),[c,p]=x.exports.useState(!1),g=q({filterInvalideProject:!1}),[,b]=E(nt),[,C]=E(Or),T=w=>{n(w)},k=({name:w,agenda:A=!1})=>{const S=[...o.getFieldValue("calendarList"),A?ln(w):sn(w)];o.setFieldsValue({calendarList:S}),p(!1),y({calendarList:S},o.getFieldsValue(!0))},y=(w,A)=>{if(w.todoist?.token?.length===40){const S=qt(w.todoist?.token);N(S)}C(A),logseq.updateSettings({calendarList:1,subscriptionList:1,projectList:1}),logseq.updateSettings({subscriptionList:[],projectList:[],...A}),typeof w.weekStartDay=="number"&&m.updateLocale("en",{weekStart:w.weekStartDay}),setTimeout(async()=>{if((w?.lightThemeType||w.theme)&&Zt(),w?.calendarList,w?.subscriptionList){const{subscriptionList:S}=await q();b(await Mo(S))}},500)},N=w=>{!w||(w?.getProjects().then(A=>{i(A?.map(S=>({value:S.id,label:S.name})))}),w?.getLabels().then(A=>{d(A?.map(S=>({value:S.id,label:S.name})))}))};return x.exports.useEffect(()=>{logseq.Editor.getAllPages().then(A=>{s(A?.filter(S=>!S?.["journal?"]).map(S=>({value:S.originalName,label:S.originalName})))});const w=qt();N(w)},[]),h("div",{className:"page-container p-8 flex flex-col items-center",children:[t("h1",{className:O(F.title,"title-text"),children:"Settings"}),h("div",{className:O(F.content,"rounded-2xl flex"),children:[h("div",{className:"flex flex-col justify-between pr-5",children:[t(_r,{value:a,tabs:Eo,onChange:T}),t(ea,{title:h("span",{children:["Are you sure you want to restore default settings?",t("br",{}),"This is an irreversible operation."]}),onConfirm:()=>{o.setFieldsValue(K),y(K,K)},children:t(U,{className:"text-left",type:"link",style:{color:"var(--ls-tertiary-background-color)"},children:"Restore Defaults"})})]}),h(f,{initialValues:g,labelCol:{span:4},preserve:!0,form:o,style:{maxWidth:"800px",width:"80%"},onValuesChange:y,className:"relative h-full",children:[h("div",{id:"basis",className:O(F.formBlock,{[F.show]:a==="basis"}),children:[t(f.Item,{label:"Theme",name:"theme",children:t($,{options:_a})}),t(f.Item,{label:"Light Theme Type",name:"lightThemeType",children:t($,{options:Ra})}),t(f.Item,{label:"Home Page",name:"homePage",children:t($,{options:st})}),t(f.Item,{label:"Ignore Tag",name:"ignoreTag",children:t($,{showSearch:!0,placeholder:"Project ID (Page Name)",optionFilterProp:"label",style:{width:"300px"},options:r,filterOption:(w,A)=>A?.label?.toLowerCase()?.includes(w?.toLowerCase())})}),t(f.Item,{label:"Default Duration",name:["defaultDuration","value"],children:t(ae,{addonAfter:t(f.Item,{name:["defaultDuration","unit"],noStyle:!0,children:t($,{style:{width:80},options:Ha})})})}),t(f.Item,{label:"Log Key",tooltip:"Interstitial Journal",children:h("div",{className:"flex items-center justify-between",children:[t(f.Item,{noStyle:!0,name:["logKey","id"],rules:[{required:!0}],children:t(J,{style:{width:"240px"}})}),t(f.Item,{name:["logKey","bgColor"],noStyle:!0,rules:[{required:!0}],children:t(z,{text:"background"})}),t(f.Item,{name:["logKey","textColor"],noStyle:!0,rules:[{required:!0}],children:t(z,{text:"text"})}),t(f.Item,{name:["logKey","borderColor"],noStyle:!0,rules:[{required:!0}],children:t(z,{text:"border"})}),t(f.Item,{name:["logKey","enabled"],noStyle:!0,valuePropName:"checked",children:t(Oe,{})})]})}),t(f.Item,{label:"Journal",required:!0,children:h("div",{className:"flex items-center justify-between",children:[t(f.Item,{noStyle:!0,name:["journal","id"],rules:[{required:!0}],children:t(J,{style:{width:"240px"},disabled:!0})}),t(f.Item,{name:["journal","bgColor"],noStyle:!0,rules:[{required:!0}],children:t(z,{text:"background"})}),t(f.Item,{name:["journal","textColor"],noStyle:!0,rules:[{required:!0}],children:t(z,{text:"text"})}),t(f.Item,{name:["journal","borderColor"],noStyle:!0,rules:[{required:!0}],children:t(z,{text:"border"})}),t(f.Item,{name:["journal","query"],rules:[{required:!0}],style:{display:"none"},children:t(Oo,{calendarId:"query"})}),t(f.Item,{name:["journal","enabled"],noStyle:!0,valuePropName:"checked",children:t(Oe,{})})]})})]}),t("div",{id:"projects",className:O(F.formBlock,{[F.show]:a==="projects"}),children:t(f.List,{name:"projectList",children:(w,{add:A,remove:S,move:v})=>t(re,{children:t(Ft,{onDragEnd:D=>{D?.destination&&v(D.source.index,D.destination.index)},children:t(Ut,{droppableId:"droppable-projects",children:(D,j)=>h("div",{ref:D.innerRef,children:[w.map((P,I)=>t(Wt,{draggableId:`drag ${I}`,index:I,children:(B,M)=>t("div",{ref:B.innerRef,...B.draggableProps,...B.dragHandleProps,children:t(f.Item,{children:h("div",{className:"flex items-center justify-between",children:[t(f.Item,{name:[P.name,"id"],noStyle:!0,rules:[{required:!0}],children:t($,{showSearch:!0,placeholder:"Project ID (Page Name)",optionFilterProp:"label",style:{width:"300px"},options:r,filterOption:(R,Z)=>Z?.label?.toLowerCase()?.includes(R?.toLowerCase())})}),t(f.Item,{name:[P.name,"bgColor"],noStyle:!0,rules:[{required:!0}],children:t(z,{text:"background"})}),t(f.Item,{name:[P.name,"textColor"],noStyle:!0,rules:[{required:!0}],children:t(z,{text:"text"})}),t(f.Item,{name:[P.name,"borderColor"],noStyle:!0,rules:[{required:!0}],children:t(z,{text:"border"})}),t(f.Item,{name:[P.name,"enabled"],noStyle:!0,valuePropName:"checked",children:t(Oe,{})}),t(Re,{onClick:()=>S(P.name)})]})})})},I)),t(f.Item,{children:t(U,{type:"dashed",onClick:()=>A(Kt),block:!0,icon:t(Ne,{}),children:"Add Project"})})]})})})})})}),h("div",{id:"customCalendar",className:O(F.formBlock,{[F.show]:a==="customCalendar"}),children:[t(Ye,{message:"Do not use this setting unless you need to write your own Query to get the calendar.",type:"warning",className:"mb-6"}),t(f.List,{name:"calendarList",children:(w,{add:A,remove:S,move:v})=>t(re,{children:t(Ft,{onDragEnd:D=>{D?.destination?.index===0||D?.source?.index===0||D?.destination&&v(D.source.index,D.destination.index)},children:t(Ut,{droppableId:"droppable-1",children:(D,j)=>h("div",{ref:D.innerRef,children:[w.map((P,I)=>t(Wt,{draggableId:`drag ${I}`,index:I,children:(B,M)=>t("div",{ref:B.innerRef,...B.draggableProps,...B.dragHandleProps,children:t(f.Item,{children:h("div",{className:"flex items-center justify-between",children:[t(f.Item,{name:[P.name,"id"],noStyle:!0,rules:[{required:!0}],children:t(J,{placeholder:"Calendar ID",style:{width:"300px"}})}),t(f.Item,{name:[P.name,"bgColor"],noStyle:!0,rules:[{required:!0}],children:t(z,{text:"background"})}),t(f.Item,{name:[P.name,"textColor"],noStyle:!0,rules:[{required:!0}],children:t(z,{text:"text"})}),t(f.Item,{name:[P.name,"borderColor"],noStyle:!0,rules:[{required:!0}],children:t(z,{text:"border"})}),t(f.Item,{name:[P.name,"query"],noStyle:!0,rules:[{required:!0}],children:t(Oo,{calendarId:"query"})}),t(f.Item,{name:[P.name,"enabled"],noStyle:!0,valuePropName:"checked",children:t(Oe,{})}),t(Re,{onClick:()=>S(P.name)})]})})})},I)),t(f.Item,{children:t(U,{type:"dashed",onClick:()=>p(!0),block:!0,icon:t(Ne,{}),children:"Add Custom Calendar"})})]})})})})})]}),t("div",{id:"subscription",className:O(F.formBlock,{[F.show]:a==="subscription"}),children:t(f.List,{name:"subscriptionList",children:(w,{add:A,remove:S})=>h(re,{children:[w.map((v,D)=>t(f.Item,{label:D===0?"Subscription":"",...D===0?{}:{wrapperCol:{offset:4}},children:h("div",{className:"flex items-center justify-between",children:[t(f.Item,{name:[v.name,"id"],noStyle:!0,rules:[{required:!0}],children:t(J,{placeholder:"Calendar ID",style:{width:"160px"}})}),t(f.Item,{name:[v.name,"url"],noStyle:!0,rules:[{required:!0,type:"url"}],children:t(J,{placeholder:"Url",style:{width:"100px"}})}),t(f.Item,{name:[v.name,"bgColor"],noStyle:!0,rules:[{required:!0}],children:t(z,{text:"background"})}),t(f.Item,{name:[v.name,"textColor"],noStyle:!0,rules:[{required:!0}],children:t(z,{text:"text"})}),t(f.Item,{name:[v.name,"borderColor"],noStyle:!0,rules:[{required:!0}],children:t(z,{text:"border"})}),t(f.Item,{name:[v.name,"enabled"],noStyle:!0,valuePropName:"checked",children:t(Oe,{})}),t(Re,{onClick:()=>S(v.name)})]})})),t(f.Item,{wrapperCol:{offset:4},children:t(U,{type:"dashed",onClick:()=>A(),block:!0,icon:t(Ne,{}),children:"Add Subscription"})})]})})}),h("div",{id:"calendar",className:O(F.formBlock,{[F.show]:a==="calendarView"}),children:[t(f.Item,{label:"Default View",name:"defaultView",rules:[{required:!0}],children:t($,{options:zt})}),t(f.Item,{label:"Week Start Day",name:"weekStartDay",rules:[{required:!0}],children:h($,{children:[t($.Option,{value:0,children:"Sunday"}),t($.Option,{value:1,children:"Monday"})]})}),t(f.Item,{label:"Time Grid",children:h("div",{className:"flex items-center",children:[t(f.Item,{noStyle:!0,name:"weekHourStart",children:t(ae,{min:0,max:24})}),t("span",{className:"px-2",children:"-"}),t(f.Item,{noStyle:!0,name:"weekHourEnd",children:t(ae,{min:0,max:24})})]})})]}),h("div",{id:"pomodoro",className:O(F.formBlock,{[F.show]:a==="pomodoro"}),children:[t(f.Item,{label:"Pomodoro Length",name:["pomodoro","pomodoro"],rules:[{required:!0}],labelCol:{span:5},children:t(ae,{min:3,precision:0,addonAfter:"min"})}),t(f.Item,{label:"Short Break Length",name:["pomodoro","shortBreak"],rules:[{required:!0}],labelCol:{span:5},children:t(ae,{min:1,precision:0,addonAfter:"min"})}),t(f.Item,{label:"Long Break Length",name:["pomodoro","longBreak"],rules:[{required:!0}],labelCol:{span:5},children:t(ae,{min:1,precision:0,addonAfter:"min"})}),t(f.Item,{label:"Long Break Interval",name:["pomodoro","longBreakInterval"],rules:[{required:!0}],labelCol:{span:5},children:t(ae,{min:1,precision:0})}),[...new Array(5).keys()].map(w=>t(f.Item,{name:["pomodoro","commonPomodoros",w],label:w===0?"Common Pomodoro":"",labelCol:{span:5},...w===0?{}:{wrapperCol:{offset:5}},children:t(ae,{min:1,addonAfter:"min"})}))]}),h("div",{id:"todoist",className:O(F.formBlock,{[F.show]:a==="todoist"}),children:[t(Ye,{message:"Restart logseq after modifying the configuration, and the synchronization icon will appear in toolbar.",type:"info",className:"mb-6"}),t(f.Item,{label:"API Token",name:["todoist","token"],labelCol:{span:8},tooltip:t(U,{type:"link",onClick:()=>logseq.App.openExternalLink("https://todoist.com/app/settings/integrations"),children:"Paste your todoist api token here"}),children:t(J,{placeholder:"Please input todoist api token"})}),t(f.Item,{label:"Sync",name:["todoist","sync"],labelCol:{span:8},children:t($,{placeholder:"Please select",options:[{label:"All Todoist Projects",value:0},{label:"A Specific Todoist Project",value:1}]})}),t(f.Item,{noStyle:!0,shouldUpdate:(w,A)=>w.todoist?.sync!==A.todoist?.sync,children:({getFieldValue:w})=>{const A=w(["todoist","sync"]);return t(f.Item,{label:A===0?"Todoist project":"Todoist project for new logseq events",name:["todoist","project"],labelCol:{span:8},children:t($,{placeholder:"Please select a todoist project",options:l})})}}),t(f.Item,{label:"Todoist label for new logseq events",name:["todoist","label"],labelCol:{span:8},children:t($,{placeholder:"Please select todoist label",options:u})})]})]})]}),t(Nr,{visible:c,onSave:k,onCancel:()=>p(!1)})]})},Jr=[{value:"todo",label:"todo"},{value:"doing",label:"doing"},{value:"done",label:"done"},{value:"waiting",label:"waiting"},{value:"canceled",label:"canceled"}],Vr=({onSearch:e,initialValues:o})=>{const[a]=f.useForm();q();const[n,r]=x.exports.useState([]),s=()=>{a.validateFields().then(l=>{e(l)})};return x.exports.useEffect(()=>{logseq.Editor.getAllPages().then(l=>{r([{value:"journal",label:"Journal"}].concat(l?.filter(i=>!i?.["journal?"]).map(i=>({value:i.originalName,label:i.originalName}))))})},[]),h(f,{form:a,initialValues:o,layout:"inline",className:"mb-6",children:[t(f.Item,{label:"Timeframe",name:"timeframe",children:t(_e.RangePicker,{allowClear:!0,ranges:{Today:[m(),m()],"This Week":[m().weekday(0),m().weekday(6)],"Last Week":[m().weekday(-7),m().weekday(-1)],"This Month":[m().startOf("month"),m().endOf("month")],"Last Month":[m().subtract(1,"month").startOf("month"),m().subtract(1,"month").endOf("month")]}})}),t(f.Item,{label:"Status",name:"status",children:t($,{options:Jr,mode:"multiple",placeholder:"Please select",style:{minWidth:"100px"},allowClear:!0})}),t(f.Item,{label:"Project",name:"project",children:t($,{showSearch:!0,allowClear:!0,mode:"multiple",placeholder:"Project ID (Page Name)",optionFilterProp:"label",style:{minWidth:"240px"},options:n,filterOption:(l,i)=>i?.label?.toLowerCase()?.includes(l?.toLowerCase())})}),t(f.Item,{children:t(U,{type:"primary",onClick:()=>s(),children:"Review"})})]})},Kr=({data:e})=>{const o=x.exports.useRef(),a=ce();return x.exports.useEffect(()=>{const n=document.getElementById("mix-line-bar");async function r(){if(!n||!a)return;const s={tooltip:{trigger:"axis",axisPointer:{type:"cross",crossStyle:{color:"#999"}}},toolbox:{feature:{dataView:{show:!0,readOnly:!0},magicType:{show:!0,type:["line","bar"]},restore:{show:!0},saveAsImage:{show:!0}}},legend:{data:["Evaporation","Precipitation","Temperature"]},xAxis:[{type:"category",data:e.map(i=>{const u=m(i.date).format("DD");return u==="01"?m(i.date).format("MM.DD"):u}),axisPointer:{type:"shadow"}}],yAxis:[{type:"value",name:"Pomodoro Amount",interval:1,axisLabel:{formatter:"{value}"}},{type:"value",name:"Pomodoro Length",interval:20,axisLabel:{formatter:"{value} min"}}],series:[{name:"Pomodoro Amount",type:"bar",tooltip:{valueFormatter:function(i){return i}},data:e.map(i=>i?.pomodoros?.length)},{name:"Interruption Amount",type:"bar",tooltip:{valueFormatter:function(i){return i}},data:e.map(i=>i?.pomodoros?.reduce((u,d)=>u+(d.interruptions?.length||0),0))},{name:"Pomodoro Length",type:"line",yAxisIndex:1,tooltip:{valueFormatter:function(i){return i+" min"}},data:e.map(i=>Math.ceil(i?.pomodoros?.reduce((u,d)=>u+d.length,0)/60))}]},l=a==="dark"?"dark":"light";window.requestAnimationFrame(()=>{const i=Le(n,l);o.current=i,i.setOption(s)})}return r(),()=>{o.current&&o.current.dispose()}},[e,a]),t("div",{id:"mix-line-bar",style:{height:"400px",width:"100%"}})},Zr=({data:e})=>{const o=x.exports.useRef(),a=ce();return x.exports.useEffect(()=>{const n=document.getElementById("treemap"),r=ta;async function s(){if(!n||!a)return;const l={title:{text:"Project Time",left:"center"},toolbox:{feature:{dataView:{show:!0,readOnly:!0},saveAsImage:{show:!0}}},tooltip:{formatter:function(u){for(var d=u.value,c=u.treePathInfo,p=[],g=1;g<c.length;g++)p.push(c[g].name);return['<div class="tooltip-title">'+r.encodeHTML(p.join("/"))+"</div>","Pomodoro Length: "+r.addCommas(d)+" min"].join("")}},series:[{name:"Project Time",type:"treemap",visibleMin:300,data:e,label:{show:!0,formatter:"{b}"},upperLabel:{show:!0,height:30},itemStyle:{borderColor:"#fff"},levels:[{itemStyle:{borderColor:"#777",borderWidth:0,gapWidth:1},upperLabel:{show:!1}},{itemStyle:{borderColor:"#555",borderWidth:5,gapWidth:1},emphasis:{itemStyle:{borderColor:"#ddd"}}},{colorSaturation:[.35,.5],itemStyle:{borderWidth:5,gapWidth:1,borderColorSaturation:.6}}]}]},i=a==="dark"?"dark":"light";window.requestAnimationFrame(()=>{const u=Le(n,i);o.current=u,u.setOption(l)})}return s(),()=>{o.current&&o.current.dispose()}},[e,a]),t("div",{id:"treemap",style:{height:"600px",width:"100%"}})},Xr=(e,o)=>{let a=e;if(o.project?.length){const n=o.project?.some(r=>r==="journal");a=a.filter(r=>n&&r.addOns.isJournal||o.project?.some(s=>s===r.addOns.project))}if(o.status?.length){const n=ge(a);a=o.status.reduce((r,s)=>r.concat(n?.[s]||[]),[])}if(o.timeframe?.length){const[n,r]=o.timeframe;a=a.filter(s=>{if(!s.rawTime)return!1;const l=m(s.addOns.start),i=s.addOns.end?m(s.addOns.end):l;return l.isSameOrBefore(r,"day")&&i.isSameOrAfter(n,"day")})}return a.sort((n,r)=>m(n.addOns.start).diff(m(r.addOns.start)))},es=(e,o)=>{const a=e.map(d=>d.addOns.pomodoros).filter(Boolean)?.flat(),n=new Map;a?.forEach(d=>{if(!d)return;const c=m(d.start).startOf("day").valueOf();n.has(c)||n.set(c,[]),n.get(c)?.push(d)});const r=Math.min(...Array.from(n.keys())),s=Math.max(...Array.from(n.keys())),[l,i]=o||[m(r),m(s)];return Wa(l,i).map(d=>{const c=d?.startOf("day").valueOf();return{date:c,pomodoros:n.get(c)||[]}})},ts=e=>{const o=new Map;e.forEach(n=>{const r=n.addOns.project;o.has(r)||o.set(r,[]),o.get(r)?.push(n)});let a=[];return o.forEach((n,r)=>{a.push({name:r,value:Math.ceil(n.reduce((s,l)=>s+bo(l),0)/60),children:n.map(s=>({name:s.addOns.showTitle,value:Math.ceil(bo(s)/60)}))})}),a},qo=e=>e.rawTime?m(e.addOns.start).valueOf():0,os=()=>{const[e]=E(fe),[o,a]=x.exports.useState({timeframe:[m().weekday(0),m().weekday(6)]}),n=Xr(e.tasks.withTime.concat(e.tasks.noTime),o),r=es(n,o?.timeframe),s=ts(n),l=i=>{a(i)};return t("div",{className:"page-container flex",children:h("div",{className:O("flex flex-1 flex-col overflow-hidden p-8"),children:[t("h1",{className:"title-text",children:"Review"}),h("div",{className:"bg-quaternary flex-1 rounded-2xl box-border p-6 overflow-auto",children:[t(Vr,{onSearch:l,initialValues:o}),t(ie,{dataSource:n,title:()=>t("div",{className:"flex justify-end",children:t(U,{size:"small",type:"link",onClick:()=>{$a(n.map(i=>i.addOns.showTitle).join(`
`)),oa.success(`\u{1F973} ${n.length} pieces of data have been copied to clipboard!`)},children:"Export"})}),columns:[{title:"Title",dataIndex:["addOns","showTitle"],width:"240px",ellipsis:!0},{title:"Project",dataIndex:["page","original-name"],render:(i,u)=>u.addOns.isJournal?"Journal":i},{title:"Date",dataIndex:["addOns","start"],width:"240px",render:(i,u)=>u.rawTime?`${m(i).format("YYYY-MM-DD")} - ${m(u.addOns.end).format("YYYY-MM-DD")}`:"-",defaultSortOrder:"descend",sorter:(i,u)=>qo(i)-qo(u),filters:[{text:"Scheduled",value:"scheduled"},{text:"No Schedule",value:"noSchedule"}],onFilter:(i,u)=>i==="noSchedule"?!Boolean(u.rawTime):i==="scheduled"?Boolean(u.rawTime):!0},{title:"Status",dataIndex:["addOns","status"]},{title:"Pomodoro Amount",dataIndex:["addOns","pomodoros"],render:i=>i?.length},{title:"Pomodoro Length",dataIndex:["addOns","pomodoros"],render:i=>`${Math.ceil(i?.reduce((u,d)=>u+d.length,0)/60)} min`}]}),t(Kr,{data:r}),t(Zr,{data:s})]})]})})},as=()=>{const[e,o]=x.exports.useState([]);return x.exports.useEffect(()=>{Qa().then(a=>{o(a)})},[]),t("div",{className:"page-container flex",children:h("div",{className:O("flex flex-1 flex-col overflow-hidden p-8"),children:[t("h1",{className:"title-text",children:"Daily Log"}),t("div",{className:"bg-quaternary flex flex-col flex-1 rounded-2xl box-border p-6",children:t(Mt,{schedules:e,isProjectCalendar:!1,isDailyLogCalendar:!0})})]})})},st=[{label:"Dashboard",value:"dashboard",icon:t(aa,{}),path:"/dashboard",element:t(pr,{})},{label:"Calendar",value:"calendar",icon:t(na,{}),path:"/calendar",element:t(wr,{})},{label:"Gantt",value:"gantt",icon:t(ra,{}),path:"/gantt",element:t(xr,{})},{label:"Timeline",value:"timeline",icon:t(sa,{}),path:"/timeline",element:t(Ar,{})},{label:"Daily Log",value:"dailyLogCalendar",icon:t(la,{}),path:"/dailyLogCalendar",element:t(as,{})},{label:"Review",value:"review",icon:t(ia,{}),path:"/review",element:t(os,{})},{label:"Settings",value:"settings",icon:t(da,{}),path:"/settings",element:t(Qr,{})}],Po=({projectId:e,mode:o})=>{const[a]=E(et),n=a?.find(s=>s.id===e),r=ce();return n?t(at,{data:[n],weekStartDay:logseq.settings?.weekStartDay||0,theme:r,defaultMode:o,uniqueId:ft()}):null},ns="_page_1ia39_1",rs="_border_1ia39_9",ss="_linkText_1ia39_12";var Pt={page:ns,border:rs,linkText:ss};const ls=({upcomingList:e,waitingList:o,doneList:a,canceledList:n,onSelect:r,value:s})=>{const l=i=>t(Me.Item,{onClick:()=>r(i),className:O("cursor-pointer px-2 rounded",{"bg-quinary":i.id+""===s}),children:h("div",{className:"flex justify-between w-full",children:[t("span",{children:i.addOns.showTitle}),i.rawTime&&t("span",{className:O(Pt.linkText,"whitespace-nowrap"),children:m(i.addOns.start).format("MM-DD")})]})});return t("div",{className:"w-full h-full",children:h(le,{ghost:!0,defaultActiveKey:["upcoming","waiting"],children:[t(le.Panel,{header:h("span",{children:[t("b",{children:"Upcoming"}),t("span",{className:"ml-2 description-text",children:e.length})]}),children:t(Me,{dataSource:e,renderItem:l})},"upcoming"),t(le.Panel,{header:h("span",{children:[t("b",{children:"Waiting"}),t("span",{className:"ml-2 description-text",children:o.length})]}),children:t(Me,{dataSource:o,renderItem:l})},"upcoming"),t(le.Panel,{header:h("span",{children:[t("b",{children:"Done"}),t("span",{className:"ml-2 description-text",children:a.length})]}),children:t(Me,{dataSource:a,renderItem:l})},"done"),t(le.Panel,{header:h("span",{children:[t("b",{children:"Canceled"}),t("span",{className:"ml-2 description-text",children:n.length})]}),children:t(Me,{dataSource:n,renderItem:l})},"canceled")]})})},is=({projectId:e})=>{const[o,a]=x.exports.useState(),[n]=E(Ce),[r]=E(De),s=e==="Journal"?n:r.get(e),l=ge(s?.tasks?.noTime||[]),i=ge(s?.tasks?.withTime||[]),u=[...i.doing,...i.todo,...l.doing,...l.todo],d=[...i.done,...l.done],c=[...i.canceled,...l.canceled],p=[...i.waiting,...l.waiting],g=async(b,C)=>{logseq.Editor.scrollToBlockInPage(b,C),logseq.hideMainUI()};return h("div",{className:"w-full h-full flex",children:[t("div",{className:O("w-1/2 overflow-auto",Pt.border),children:t(ls,{waitingList:p,upcomingList:u,doneList:d,canceledList:c,onSelect:a,value:o?.id+""})}),t("div",{className:"w-1/2 overflow-auto",children:o&&h("div",{className:"pl-4",children:[t("h3",{children:o.addOns.showTitle}),t("p",{className:"whitespace-pre-line",children:o.content}),t(U,{type:"link",className:"px-0",onClick:()=>g(o.page.originalName,o.uuid),children:"Navigate To Block"})]})})]})},ds=()=>{const{projectId:e=""}=ca(),o=decodeURIComponent(e),[a]=E(Sn),[n]=E(Nn),r=o==="Journal"?a?.schedules:n.find(s=>s?.calendarConfig?.id===o)?.schedules||[];return h("div",{className:O(Pt.page,"page-container p-8 flex flex-col items-center"),children:[t("h1",{className:"title-text w-full",children:o}),t("div",{className:"rounded-2xl flex w-full h-full p-6 bg-quaternary",children:o&&h(Ie,{className:"w-full",tabPosition:"left",children:[t(Ie.TabPane,{tab:"List",children:t(is,{projectId:o})},"list"),t(Ie.TabPane,{tab:"Calendar",children:t(Mt,{schedules:r,isProjectCalendar:!0})},"calendar"),t(Ie.TabPane,{tab:"Gantt",children:t(Po,{projectId:o,mode:"advanced"})},"gantt"),t(Ie.TabPane,{tab:"Timeline",children:t(Po,{projectId:o,mode:"simple"})},"timeline")]})})]})},cs=({defaultRoute:e})=>{const[,o]=E(nt),[,a]=E(fe),[,n]=E(Ce),[,r]=E(De),{homePage:s=K.homePage,logKey:l}=q(),i=st.find(d=>d.value===s)?.element,u=l?.enabled?st:st.filter(d=>d.value!=="dailyLogCalendar");return x.exports.useEffect(()=>{async function d(){const c=await Tt();if(c){const{fullEvents:g,journalEvents:b,projectEventsMap:C}=c;a(g),n(b),r(C)}const{subscriptionList:p}=q();o(await Mo(p))}d()},[]),t("main",{className:"w-screen h-screen flex",prefix:"custom",children:h(ua,{children:[t(kn,{defaultRoute:e,menus:u}),h(ma,{children:[t(pt,{path:"/",element:i}),u.map(d=>t(pt,{path:d.path,element:d.element},d.value)),t(pt,{path:"/project/:projectId",element:t(ds,{})})]})]})})};const us=({visible:e,uuid:o,onSave:a,onCancel:n})=>{const[r,s]=x.exports.useState(!1),[l]=E(Xe),i=l.map(g=>({label:g.addOns.showTitle,value:g.uuid})),[u,d]=x.exports.useState([]),c=()=>{i.length===u.length?d([]):d(i.map(g=>g.value))},p=async()=>{let g=[];for(let b=0;b<u.length;b++){const C=await ve({uuid:u[b]});g.push(C)}logseq.Editor.insertBatchBlock(o,g.map(b=>({content:`((${b?.uuid}))`})),{before:!1,sibling:!0}),a()};return x.exports.useEffect(()=>{u?.length>0&&u.length<i.length?s(!0):s(!1)},[u?.length,i?.length]),h(se,{visible:e,title:"Insert Today Task",onCancel:n,onOk:p,children:[t(Ye,{className:"mb-2",message:"It is not recommended to use this feature for the time being, as it may cause some block refs to be lost after reindex, unless you ensure that all embed blocks generate id.",type:"warning"}),t(Ye,{className:"mb-2",message:"You can jump to the corresponding block by clicking the task from the sidebar and then copy the block ref.",type:"warning"}),t(ht.Group,{value:u,onChange:g=>d(g),children:i.map((g,b)=>t(Ht,{children:t(mt,{span:24,children:t(ht,{value:g.value,children:g.label},g.value)})}))}),t(Yt,{}),t(ht,{indeterminate:r,checked:i.length===u.length,onClick:c,children:"Check All"})]})},ms=({visible:e,onCancel:o,onOk:a,data:n})=>{const[r]=f.useForm();return x.exports.useEffect(()=>{n&&r.setFieldsValue({...n,start:n.start?m(n.start):m(),length:Math.ceil(n.length/60)||1,interruptions:n.interruptions?.map(s=>({...s,time:s.time?m(s.time):m()}))||[]})},[n?.start]),t(se,{title:"Modify Pomodoro",visible:e,onCancel:o,onOk:async()=>{const s=await r.validateFields();a({...s,start:s.start.valueOf(),length:s.length*60,interruptions:s.interruptions?.map(l=>({...l,time:l.time.valueOf()}))})},children:h(f,{form:r,children:[t(f.Item,{name:"isFull",label:"Is Full",rules:[{required:!0}],children:h(W.Group,{children:[t(W,{value:!0,children:"Full Tomato"}),t(W,{value:!1,children:"Half Tomato"})]})}),t(f.Item,{name:"start",label:"Start Time",rules:[{required:!0}],children:t(_e,{showTime:{format:"HH:mm"},format:"YYYY-MM-DD HH:mm"})}),t(f.Item,{name:"length",label:"Length",rules:[{required:!0}],children:t(ae,{min:1,addonAfter:"min"})})]})})},ps=({data:e,onCancel:o,onOk:a,visible:n})=>{const[r,s]=x.exports.useState(e.addOns.pomodoros||[]),[l,i]=x.exports.useState({visible:!1}),u=()=>{const{pomodoro:d}=q();s([...r,{start:m().valueOf(),length:d.pomodoro*60,isFull:!0}])};return x.exports.useEffect(()=>{s(e.addOns.pomodoros||[])},[e.uuid]),h(se,{title:"Pomodoro",okText:"Save",width:"800px",visible:n,onCancel:o,onOk:async()=>{const d=await Dt(e.uuid,r,"update");d&&logseq.Editor.updateBlock(e.uuid,d),o()},children:[t(U,{type:"primary",onClick:u,className:"mb-4",icon:t(Ne,{}),children:"Add New Pomodoro"}),t(ie,{pagination:!1,dataSource:r,id:"start",columns:[{title:"Full Tomato",dataIndex:"isFull",render(d,c,p){return d?"\u2705":"\u274C"}},{title:"Length",dataIndex:"length",render:d=>`${Math.ceil(d/60)} min`},{title:"Start",dataIndex:"start",width:"200px",render:d=>m(d).format("YYYY-MM-DD HH:mm")},ie.EXPAND_COLUMN,{title:"Interruption",dataIndex:"interruptions",render:(d,c,p)=>d?.length||0},{title:"Action",dataIndex:"operation",render:(d,c,p)=>t(U,{type:"link",onClick:()=>i({visible:!0,data:c}),children:"Edit"})}],expandable:{rowExpandable:d=>Boolean(d?.interruptions?.length),expandedRowRender:d=>t(ie,{size:"small",dataSource:d.interruptions,pagination:!1,columns:[{title:"Type",dataIndex:"type",render:c=>c===1?t(Gt,{color:"green",children:"Internal"}):t(Gt,{color:"magenta",children:"External"})},{title:"Time",dataIndex:"time",render:c=>m(c).format("YYYY-MM-DD HH:mm")},{title:"Remark",dataIndex:"remark"}]})},summary:d=>d?.length?t(re,{children:h(ie.Summary.Row,{children:[t(ie.Summary.Cell,{index:0,children:"Total"}),h(ie.Summary.Cell,{index:1,colSpan:3,children:[Math.ceil(d.reduce((c,p)=>c+p.length,0)/60)," min"]}),t(ie.Summary.Cell,{index:4,colSpan:2,children:d.reduce((c,p)=>c+(p.interruptions?.length||0),0)})]})}):null}),t(ms,{visible:l.visible,data:l.data,onCancel:()=>i({visible:!1}),onOk:d=>{l?.data?.start&&(s(r.map(c=>c.start===l.data?.start?{...c,...d}:c)),i({visible:!1}))}})]})},hs=e=>{E(To);const[,o]=E(fe),[,a]=E(Ce),[,n]=E(De),r=e.type,s=()=>{logseq.hideMainUI()},l=()=>{logseq.hideMainUI()};return x.exports.useEffect(()=>{async function i(){const u=await Tt();if(u){const{fullEvents:d,journalEvents:c,projectEventsMap:p}=u;o(d),a(c),n(p)}}r==="insertTodaySchedule"&&i()},[r]),h("div",{className:"w-screen h-screen",children:[r==="editSchedule"&&t(No,{visible:!0,showKeepRef:e.showKeepRef,type:e.data.type,initialValues:e.data.initialValues,onSave:s,onCancel:l}),r==="insertTodaySchedule"&&t(us,{visible:!0,uuid:e.data.uuid,onSave:s,onCancel:l}),r==="pomodoro"&&t(ps,{visible:!0,data:e.data,onOk:s,onCancel:l})]})};function gs(e,o=!1){const a=e?.addOns.start,n=e?.addOns.end,r=m(a),s=m(n),l=r.isSame(s,"day");return o?e.addOns.allDay?l?{start:r.format("MM-DD")}:{start:r.format("MM-DD"),end:s.format("MM-DD")}:l&&r.isSame(m(),"day")?{start:r.format("HH:mm"),end:s.format("HH:mm")}:l?{start:r.format("MM-DD")}:{start:r.format("MM-DD"),end:s.format("MM-DD")}:l?e.addOns.allDay?{start:"all-day"}:{start:r.format("HH:mm"),end:s.format("HH:mm")}:{start:r.format("MM-DD"),end:s.format("MM-DD")}}const jt=({task:e,type:o="allDay"})=>{const a=m(e.addOns.start),n=m(e.addOns.end),r=o==="time"&&m().isBetween(a,n),s=e.addOns.status==="done",l=e.addOns.calendarConfig,{start:i,end:u}=gs(e,o==="overdue");return h("div",{className:"agenda-sidebar-task flex cursor-pointer",style:{margin:"10px 0",opacity:s?.4:.9},onClick:async()=>{const{id:c,originalName:p}=e?.page||{};let g=p;g||(g=(await de({id:c}))?.originalName),logseq.Editor.scrollToBlockInPage(g,e.uuid)},children:[h("div",{className:"flex flex-col justify-between text-right",style:{color:o==="overdue"?"#ed4245":"var(--ls-icon-color)",fontSize:"0.8em",width:"50px"},children:[t("div",{className:"w-full",children:i}),u&&t("div",{className:"w-full",style:{opacity:.6},children:u})]}),t("div",{style:{width:"4px",backgroundColor:l?.bgColor,borderRadius:"2px",margin:"0 6px"}}),h("div",{style:{width:"calc(100% - 90px)",paddingBottom:"24px",position:"relative"},children:[t("div",{style:{color:"var(--ls-icon-color)",fontSize:"0.8em",opacity:.6},children:l?.id}),t("div",{className:"agenda-sidebar-task__title",style:{marginBottom:"-0.2em",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",position:"absolute",bottom:0,width:"calc(100% - 30px)"},title:e.addOns.showTitle,children:e.addOns.showTitle}),r&&t("span",{className:"ui__button bg-indigo-600",style:{fontSize:"0.5em",position:"absolute",right:0,bottom:0,padding:"0 3px",borderRadius:"3px"},children:"NOW"})]})]})};function fs(e){const o=e.start,a=e.end,n=m(o),r=m(a);return n.isSame(r,"day")?e.isAllDay?{start:"all-day"}:{start:n.format("HH:mm"),end:r.format("HH:mm")}:{start:n.format("MM-DD"),end:r.format("MM-DD")}}const jo=({subscription:e,type:o="allDay"})=>{const a=m(e.start),n=m(e.end),r=o==="time"&&m().isBetween(a,n),{start:s,end:l}=fs(e);return h("div",{className:"agenda-sidebar-task flex cursor-pointer",style:{margin:"10px 0",opacity:.9},children:[h("div",{className:"flex flex-col justify-between text-right",style:{color:"var(--ls-icon-color)",fontSize:"0.8em",width:"50px"},children:[t("div",{className:"w-full",children:s}),l&&t("div",{className:"w-full",style:{opacity:.6},children:l})]}),t("div",{style:{width:"4px",backgroundColor:e.bgColor,borderRadius:"2px",margin:"0 6px"}}),h("div",{style:{width:"calc(100% - 90px)",paddingBottom:"24px",position:"relative"},children:[t("div",{style:{color:"var(--ls-icon-color)",fontSize:"0.8em",opacity:.6},children:e?.calendarId}),t("div",{className:"agenda-sidebar-task__title",style:{marginBottom:"-0.2em",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",position:"absolute",bottom:0,width:"calc(100% - 30px)"},title:e.title,children:e.title}),r&&t("span",{className:"ui__button bg-indigo-600",style:{fontSize:"0.5em",position:"absolute",right:0,bottom:0,padding:"0 3px",borderRadius:"3px"},children:"NOW"})]})]})},ys=({containerId:e})=>{E(To);const[o]=E(Ao),{allDaySubscriptions:a,timeSubscriptions:n}=so(o),[r]=E(Xe),{overdueTasks:s,allDayTasks:l,timeTasks:i}=ro(r),[,u]=E(fe),[,d]=E(Ce),[,c]=E(De);return x.exports.useEffect(()=>{async function p(){const g=await Tt();if(g){const{fullEvents:b,journalEvents:C,projectEventsMap:T}=g;u(b),d(C),c(T)}}p(),logseq.DB.onChanged(({blocks:g,txData:b,txMeta:C})=>{b?.some(T=>T?.[1]==="marker")&&parent.document.querySelector("#"+e)&&p()})},[]),h("main",{children:[s?.length===0&&l?.length===0&&i?.length===0&&t("div",{children:"Empty task list"}),s.length>0&&t("div",{style:{margin:"8px 0"},children:s.map(p=>t(jt,{task:p,type:"overdue"},p.id))}),(l.length>0||a.length>0)&&h("div",{children:[a.map(p=>t(jo,{subscription:p,type:"allDay"},p.id)),l.map(p=>t(jt,{task:p,type:"allDay"},p.id))]}),(i.length>0||n.length>0)&&h("div",{children:[n.map(p=>t(jo,{subscription:p,type:"time"},p.id)),i.map(p=>t(jt,{task:p,type:"time"},p.id))]})]})},ws=({visible:e,pomodoroId:o,uuid:a,onCancel:n,onOk:r})=>{const[s]=f.useForm();return t(se,{title:"Record Inerruption",visible:e,onCancel:n,onOk:async()=>{const l=await s.validateFields(),i=window.interruptionMap.get(o)||[];window.interruptionMap.set(o,i.concat({type:l.type,remark:l.remark,time:m().valueOf()})),n()},children:h(f,{form:s,labelCol:{span:4},children:[t(f.Item,{name:"type",label:"Type",initialValue:1,rules:[{required:!0}],children:t(W.Group,{optionType:"button",buttonStyle:"solid",options:[{label:"Internal",value:1},{label:"External",value:2}]})}),t(f.Item,{name:"remark",label:"Remark",rules:[{required:!0}],children:t(J,{maxLength:50,showCount:!0})})]})})},Be=({label:e,onClick:o,classNames:a=""})=>t("button",{onClick:o,className:`border-transparent font-medium shadow-sm px-3 py-2 text-sm leading-4 rounded-md bg-red-600 hover:bg-red-500 text-white uppercase cursor-pointer ${a}`,children:e}),bs=({label:e,onClick:o,classNames:a=""})=>t("button",{onClick:o,className:`border-transparent bg-transparent font-medium shadow-sm w-12 h-5 text-xs leading-4 rounded-md border border-solid cursor-pointer description-text ${a}`,children:e}),ks=({uuid:e})=>{const o=x.exports.useMemo(()=>{const{pomodoro:v}=q();return{...v,pomodoro:v.pomodoro*60,shortBreak:v.shortBreak*60,longBreak:v.longBreak*60,notificationConfig:{type:"every",time:5}}},[e]),{state:a,start:n,stop:r,reset:s,goPomodoro:l,goShortBreak:i,goLongBreak:u,changeConfig:d}=pa(o),{pomodoro:c}=q(),[p,g]=x.exports.useState(),b=a.type==="pomodoro",C=x.exports.useRef(),[T,k]=x.exports.useState(!1),y=v=>{d({...a.config,pomodoro:v*60})},N=async()=>{if(!p)return;const{id:v,originalName:D}=p?.page||{};let j=D;j||(j=(await de({id:v}))?.originalName),logseq.Editor.scrollToBlockInPage(j,p.uuid)},w=()=>{n();const v=m().valueOf();C.current=v,window.interruptionMap.set(v,[])},A=async()=>{const v=a.config.pomodoro,D=a.timer;s();const j=await Dt(e,{isFull:!1,start:C.current,length:v-D,interruptions:window.interruptionMap.get(C.current)||[]});j&&logseq.Editor.updateBlock(e,j)},S=()=>{const{progress:v}=a;return b?v===0?t(Be,{label:"start",onClick:w}):[t(Be,{label:"stop",onClick:s},"stop"),t(Be,{label:"finish",onClick:A,classNames:"ml-2"},"finish")]:v===0?t(Be,{label:"start",onClick:n,classNames:"bg-green-600 hover:bg-green-500"}):t(Be,{label:"skip",onClick:l,classNames:"bg-green-600 hover:bg-green-500"})};return x.exports.useEffect(()=>{logseq.App.registerUIItem("toolbar",{key:"logseq-plugin-agenda-pomodoro",template:fo(e,a.formattedTimer,a.progress,a.type!=="pomodoro")}),window.currentPomodoro={uuid:e,state:{paused:a.paused}}},[a.formattedTimer,a.type,a.paused,e]),x.exports.useEffect(()=>{if(!!e){if(!a.paused)return logseq.App.showMsg("Pomodoro is running, please stop it first.","error");logseq.Editor.getBlock(e).then(async v=>{if(!v)return;const D=await oe(v,q());g(D)})}},[e]),x.exports.useEffect(()=>{b&&a.progress===1&&e&&(Dt(e,{isFull:!0,start:C.current,length:a.config.pomodoro,interruptions:window.interruptionMap.get(C.current)||[]}).then(v=>logseq.Editor.updateBlock(e,v)),Ga("Pomodoro is finished!"))},[b,a.progress,e]),h(re,{children:[t("div",{className:"fixed top-0 left-0 w-screen h-screen",onClick:()=>logseq.hideMainUI()}),h("div",{className:"fixed right-10 shadow-md px-4 py-6 rounded-md bg-quaternary flex",style:{top:"48px",minWidth:"300px"},children:[h("div",{className:"flex-1",children:[h("div",{className:"singlge-line-ellipsis cursor-pointer description-text flex items-center",style:{maxWidth:"220px"},onClick:N,title:p?.addOns.showTitle,children:[p?.addOns.showTitle,t(Rt,{})]}),h("div",{children:[t("p",{className:"text-center text-4xl mt-6 mb-6",children:a.formattedTimer}),t("div",{className:"flex flex-row justify-center",children:S()})]})]}),t("div",{className:"flex flex-col w-12 justify-between pt-2",children:c?.commonPomodoros?.map(v=>t(bs,{label:v+"min",onClick:()=>y(v)},v))}),h("div",{className:"absolute right-5 top-1 opacity-60",children:[t(ha,{className:"cursor-pointer",onClick:()=>k(!0)}),t(Lt,{className:"ml-2 cursor-pointer",onClick:()=>{logseq.hideMainUI(),window?.unmountPomodoroApp(),window.currentPomodoro={},window.interruptionMap.delete(C.current),logseq.App.registerUIItem("toolbar",{key:"logseq-plugin-agenda-pomodoro",template:'<div class="agenda-toolbar-pompdoro hide"></div>'})}})]})]}),t(ws,{pomodoroId:C.current,visible:T,onCancel:()=>k(!1)})]})};m.extend(ga);m.extend(fa);m.extend(ya);m.extend(wa);m.extend(ba);m.extend(ka);m.extend(va);m.extend(xa);Ca([Da,Ta,Aa,Sa,Na,Oa,Ma,Ia,Ea,qa]);ke("=== logseq-plugin-agenda loaded ==="),logseq.ready(()=>{an();const{weekStartDay:e,todoist:o}=q();m.updateLocale("en",{weekStart:e}),Zt(),Notification.requestPermission(),logseq.App.getUserConfigs().then(n=>{window.logseqAppUserConfigs=n}),Fa(()=>logseq.hideMainUI()),logseq.App.onThemeModeChanged(({mode:n})=>{Ge(n)}),logseq.on("ui:visible:changed",n=>{!n.visible&&window.currentApp!=="pomodoro"&&be.unmountComponentAtNode(document.getElementById("root"))}),logseq.provideModel({show(){Bo(),logseq.showMainUI()},showPomodoro(n){const r=n.dataset.uuid;if(!r)return logseq.App.showMsg("uuid is required");Lo(r),logseq.showMainUI()},pullTodoistTasks(){Rr()}}),logseq.App.registerUIItem("toolbar",{key:"logseq-plugin-agenda",template:'<a data-on-click="show" class="button"><i class="ti ti-comet"></i></a>'}),o?.token&&(logseq.App.registerUIItem("toolbar",{key:"plugin-agenda-todoist",template:'<a data-on-click="pullTodoistTasks" class="button"><i class="ti ti-chevrons-down"></i></a>'}),qt(),logseq.DB.onChanged(({blocks:n,txData:r,txMeta:s})=>{on(async i=>{const u=await logseq.Editor.getBlock(i),d=await oe(u,q());console.info("[faiz:] === sync block to todoist",d);const c=d.properties?.todoistId;try{const p=await Hr(c),g=Pa(rt,C=>C===d.priority);let b={content:d.addOns.contentWithoutTime?.split(`
`)?.[0],priority:g};if(d.addOns.allDay===!0&&(b.dueDate=m(d.addOns.start).format("YYYY-MM-DD")),d.addOns.allDay===!1&&(b.dueDatetime=m.utc(d.addOns.start).format()),d.addOns.status==="done"&&p?.completed===!1)return $r(c);if(d.addOns.status!=="done"&&p?.completed===!0)return Fr(c);Yr(c,b)}catch(p){if(p.httpStatusCode===404)return logseq.App.showMsg(`Sync Error
message: ${p?.responseData}
Please check whether the task has been deleted or whether the todoist-id is correct`,"error")}})?.({blocks:n,txData:r,txMeta:s})}),logseq.Editor.registerBlockContextMenuItem("Agenda: Upload to todoist",async({uuid:n})=>{const r=q(),{todoist:s}=r,l=await logseq.Editor.getBlock(n);if(!l?.marker)return logseq.App.showMsg("This block is not a task","error");if(l?.properties?.todoistId)return logseq.App.showMsg(`This task has already been uploaded,
please do not upload it again`,"error");const i=await oe(l,r);let u={content:i.addOns.contentWithoutTime?.split(`
`)?.[0]};i.addOns.allDay===!0&&(u.dueDate=m(i.addOns.start).format("YYYY-MM-DD")),i.addOns.allDay===!1&&(u.dueDatetime=m.utc(i.addOns.start).format()),s?.project&&(u.projectId=s.project),s?.label&&(u.labelIds=[s.label]),Ur(u)?.then(async d=>(await Io(i,d),logseq.App.showMsg("Upload task to todoist success"))).catch(d=>{logseq.App.showMsg("Upload task to todoist failed","error"),console.error("[faiz:] === Upload task to todoist failed",d)})})),logseq.App.registerCommandPalette({key:"logseq-plugin-agenda:show",label:"Show Agenda",keybinding:{binding:"ctrl+shift+a"}},n=>{Bo(),logseq.showMainUI()}),window.unmountPomodoroApp=()=>be.unmountComponentAtNode(document.getElementById("pomodoro-root")),window.interruptionMap=new Map;const a=async n=>{let r=await logseq.Editor.getBlock(n.uuid);const s=await Promise.all(r.refs?.map(i=>logseq.Editor.getPage(i.id)));r.refs=s;const l=await oe(r,q());lt({type:"editSchedule",data:{type:"update",initialValues:{id:l.uuid,start:m(l.addOns.start),end:m(l.addOns.end),isAllDay:l.addOns.allDay,calendarId:l.addOns.calendarConfig?.id,title:l.addOns.showTitle,raw:l}},showKeepRef:!0}),logseq.showMainUI()};logseq.App.registerPageMenuItem("Agenda: Add this page to agenda project",({page:n})=>{const r=logseq.settings?.projectList||[];if(r.find(l=>l.id===n))return logseq.App.showMsg("This Page is already in agenda project","warning");const s={...Kt,id:n};logseq.updateSettings({projectList:1}),logseq.updateSettings({...logseq.settings,projectList:r.concat(s)}),logseq.App.showMsg("Successfully added")}),logseq.Editor.registerBlockContextMenuItem("Agenda: Modify Schedule",a),logseq.Editor.registerBlockContextMenuItem("Agenda: Start Pomodoro Timer",async({uuid:n})=>{if(logseq.App.registerUIItem("toolbar",{key:"logseq-plugin-agenda-pomodoro",template:fo(n,"--:--",0)}),window?.currentPomodoro?.uuid!==n&&window?.currentPomodoro?.state?.paused===!1)return logseq.App.showMsg("Another block is running pomodoro timer, please finish it first","error");setTimeout(()=>{Lo(n),logseq.showMainUI()},0)}),logseq.Editor.registerSlashCommand("Agenda: Modify Schedule",a),logseq.Editor.registerSlashCommand("Agenda: Insert Today's Task",n=>(lt({type:"insertTodaySchedule",data:{uuid:n.uuid}}),logseq.showMainUI(),Promise.resolve())),logseq.Editor.registerSlashCommand("Agenda: Insert Task List",async()=>{logseq.Editor.insertAtEditingCursor("{{renderer agenda, task-list}}")}),logseq.App.onMacroRendererSlotted(async({slot:n,payload:{arguments:r,uuid:s}})=>{if(r?.[0]==="agenda"){if(r?.[1]==="task-list"){if(parent.document.getElementById(n)?.childElementCount)return;const i=`agenda-task-list-${n}`;logseq.provideUI({key:`agenda-${n}`,slot:n,reset:!0,template:`<div id="${i}"></div>`}),logseq.provideStyle(`${go}
          #block-content-${s} .lsp-hook-ui-slot {
            width: 100%;
          }
          #block-content-${s} .lsp-hook-ui-slot > div {
            width: 100%;
          }
          #block-content-${s} .lsp-hook-ui-slot > div > div {
            width: 100%;
          }
        `),setTimeout(()=>{be.render(t(He.StrictMode,{children:t(ys,{containerId:i})}),parent.document.getElementById(i))},0)}else if(r?.[1]==="pomodoro-timer"){const l=`agenda-pomodoro-timer-${n}`;logseq.provideUI({key:`agenda-${n}`,slot:n,reset:!0,template:`<div id="${l}"></div>`})}}}),logseq.setMainUIInlineStyle({zIndex:1e3}),logseq.provideStyle(go),top&&top.document.addEventListener("click",async n=>{const r=n.composedPath(),s=r[0];if(s.tagName==="A"&&s.className.includes("external-link")&&s.getAttribute("href")?.startsWith("#agenda")){let l="agenda";s.getAttribute("href")?.startsWith("#agenda-pomo://")&&(l="pomodoro");const i=tn(r);if(!i)return;const u=await logseq.Editor.getBlock(i),d=await logseq.Editor.getPage(u.page?.id),c=await oe(u,q());l==="agenda"?lt({type:"editSchedule",data:{type:"update",initialValues:{id:i,title:c.addOns.showTitle,calendarId:d?.originalName,keepRef:!1,start:m(c.addOns.start),end:m(c.addOns.end),isAllDay:c.addOns.allDay,raw:c}}}):l==="pomodoro"&&lt({type:"pomodoro",data:c}),logseq.showMainUI()}})});async function Bo(){window.currentApp="app",Ct(!1),gt(!1);let e="";const o=await logseq.Editor.getCurrentPage(),{projectList:a=[]}=q();a.some(n=>Boolean(n.id)&&n.id===o?.originalName)&&(e=`project/${encodeURIComponent(o?.originalName)}`),be.render(t(He.StrictMode,{children:t(cs,{defaultRoute:e})}),document.getElementById("root"))}function lt(e){window.currentApp="modal",Ct(!1);const{type:o,data:a}=e;gt(!0),be.render(t(He.StrictMode,{children:t(hs,{type:o,data:a,showKeepRef:e.showKeepRef})}),document.getElementById("root"))}function Lo(e){window.currentApp="pomodoro",Ct(!0),gt(!0),be.render(t(He.StrictMode,{children:t(ks,{uuid:e})}),document.getElementById("pomodoro-root"))}
